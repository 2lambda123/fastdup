
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.3.9">
    
    
      
        <title>Fastdup documentation</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.1d29e8d0.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL(".",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fastdup-documentation-page" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Fastdup documentation" class="md-header__button md-logo" aria-label="Fastdup documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Fastdup documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Fastdup documentation page
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Fastdup documentation" class="md-nav__button md-logo" aria-label="Fastdup documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Fastdup documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Fastdup documentation page
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Fastdup documentation page
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fastdup.run" class="md-nav__link">
    fastdup.run
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.run_kmeans" class="md-nav__link">
    fastdup.run_kmeans
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.run_kmeans_on_extracted" class="md-nav__link">
    fastdup.run_kmeans_on_extracted
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup-visualization-of-results" class="md-nav__link">
    Fastdup visualization of results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_duplicates_gallery" class="md-nav__link">
    fastdup.create_duplicates_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_duplicate_videos_gallery" class="md-nav__link">
    fastdup.create_duplicate_videos_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_outliers_gallery" class="md-nav__link">
    fastdup.create_outliers_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_components_gallery" class="md-nav__link">
    fastdup.create_components_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_component_videos_gallery" class="md-nav__link">
    fastdup.create_component_videos_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_kmeans_clusters_gallery" class="md-nav__link">
    fastdup.create_kmeans_clusters_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_stats_gallery" class="md-nav__link">
    fastdup.create_stats_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_similarity_gallery" class="md-nav__link">
    fastdup.create_similarity_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_aspect_ratio_gallery" class="md-nav__link">
    fastdup.create_aspect_ratio_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup-classifiers" class="md-nav__link">
    Fastdup classifiers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_knn_classifier" class="md-nav__link">
    fastdup.create_knn_classifier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_kmeans_classifier" class="md-nav__link">
    fastdup.create_kmeans_classifier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup-utilities" class="md-nav__link">
    Fastdup utilities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.load_binary_feature" class="md-nav__link">
    fastdup.load_binary_feature
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.save_binary_feature" class="md-nav__link">
    fastdup.save_binary_feature
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.generate_sprite_image" class="md-nav__link">
    fastdup.generate_sprite_image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.export_to_tensorboard_projector" class="md-nav__link">
    fastdup.export_to_tensorboard_projector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.export_to_cvat" class="md-nav__link">
    fastdup.export_to_cvat
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.export_to_labelImg" class="md-nav__link">
    fastdup.export_to_labelImg
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup-utilities-to-remove-images" class="md-nav__link">
    Fastdup utilities to remove images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.find_top_components" class="md-nav__link">
    fastdup.find_top_components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.delete_components" class="md-nav__link">
    fastdup.delete_components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.delete_or_retag_stats_outliers" class="md-nav__link">
    fastdup.delete_or_retag_stats_outliers
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fastdup.run" class="md-nav__link">
    fastdup.run
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.run_kmeans" class="md-nav__link">
    fastdup.run_kmeans
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.run_kmeans_on_extracted" class="md-nav__link">
    fastdup.run_kmeans_on_extracted
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup-visualization-of-results" class="md-nav__link">
    Fastdup visualization of results
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_duplicates_gallery" class="md-nav__link">
    fastdup.create_duplicates_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_duplicate_videos_gallery" class="md-nav__link">
    fastdup.create_duplicate_videos_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_outliers_gallery" class="md-nav__link">
    fastdup.create_outliers_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_components_gallery" class="md-nav__link">
    fastdup.create_components_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_component_videos_gallery" class="md-nav__link">
    fastdup.create_component_videos_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_kmeans_clusters_gallery" class="md-nav__link">
    fastdup.create_kmeans_clusters_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_stats_gallery" class="md-nav__link">
    fastdup.create_stats_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_similarity_gallery" class="md-nav__link">
    fastdup.create_similarity_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_aspect_ratio_gallery" class="md-nav__link">
    fastdup.create_aspect_ratio_gallery
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup-classifiers" class="md-nav__link">
    Fastdup classifiers
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_knn_classifier" class="md-nav__link">
    fastdup.create_knn_classifier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.create_kmeans_classifier" class="md-nav__link">
    fastdup.create_kmeans_classifier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup-utilities" class="md-nav__link">
    Fastdup utilities
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.load_binary_feature" class="md-nav__link">
    fastdup.load_binary_feature
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.save_binary_feature" class="md-nav__link">
    fastdup.save_binary_feature
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.generate_sprite_image" class="md-nav__link">
    fastdup.generate_sprite_image
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.export_to_tensorboard_projector" class="md-nav__link">
    fastdup.export_to_tensorboard_projector
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.export_to_cvat" class="md-nav__link">
    fastdup.export_to_cvat
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.export_to_labelImg" class="md-nav__link">
    fastdup.export_to_labelImg
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup-utilities-to-remove-images" class="md-nav__link">
    Fastdup utilities to remove images
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.find_top_components" class="md-nav__link">
    fastdup.find_top_components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.delete_components" class="md-nav__link">
    fastdup.delete_components
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fastdup.delete_or_retag_stats_outliers" class="md-nav__link">
    fastdup.delete_or_retag_stats_outliers
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="fastdup-documentation-page">Fastdup documentation page</h1>
<p>The main function is <code>fastdup.run</code>. It runs on a folder or list of images and computes the artifacts needed to compute image similrity, outliers, componetns etc.</p>
<p><code>fastdup.run</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.run"></a>
  <div class="doc doc-contents first">
  
      <p>Run fastdup tool for finding duplicate, near duplicates, outliers and clusters of related images in a corpus of images.<br />
The only mandatory argument is image_dir.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Location of the images/videos to analyze.<br />
    * A folder<br />
    * A remote folder (s3 or minio starting with s3:// or minio://). When using minio append the minio server name for example minio://google/visual_db/sku110k.<br />
    * A file containing absolute filenames each on its own row.<br />
    * A file containing s3 full paths or minio paths each on its own row.<br />
    * A python list with absolute filenames<br />
    * yolov5 yaml input file containing train and test folders (single folder supported for now)<br />
    * We support jpg, jpeg, tiff, tif, giff, png, mp4, avi. In addition we support tar, tar.gz, tgz and zip files containing images.<br />
If you have other image extensions that are readable by opencv imread() you can give them in a file (each image on its own row) and then we do not check for the<br />
known extensions and use opencv to read those formats.<br />
Note: It is not possible to mix compressed (videos or tars/zips) and regular images. Use the flag turi_param='tar_only=1' if you want to ignore images and run from compressed files.<br />
Note: We assume image sizes should be larger than 10x10 pixels. Smaller images will be ignored with a warning shown.<br />
Note: It is possible to skip small images also by defining minimum allowed file size using turi_param='min_file_size=1000' (in bytes).<br />
Note: For performance reasons it is always preferred to copy s3 images from s3 to local disk and then run fastdup on local disk. Since copying images from s3 in a loop is very slow.<br />
Alternatively you can use the flag turi_param='sync_s3_to_local=1' to copy ahead all images on the remote s3 bucket to disk.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional path for storing intermediate files and results.</p></td>
          <td>
                <code>&#39;.&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>test_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional path for test data. When given similarity of train and test images is compared (vs. train/train or test/test which are not performed).<br />
The following options are supported.<br />
    * test_dir can be a local folder path<br />
    * An s3:// or minio:// path.<br />
    * A python list with absolute filenames<br />
    * A file containing absolute filenames each on its own row.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>compute</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Compute type [cpu|gpu] Note: gpu is supported only in the enterprise version.</p></td>
          <td>
                <code>&#39;cpu&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>Verbosity.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>num_threads</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of threads. If no value is specified num threads is auto configured by the number of cores.</p></td>
          <td>
                <code>-1</code>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>unsigned long long</code>
          </td>
          <td><p>Number of images to run on. On default, run on all the images in the image_dir folder.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>turi_param</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional turi parameters seperated by command. Example run: turi_param='nnmodel=0,ccthreshold=0.99'<br />
The following parameters are supported.<br />
    * nnmodel=xx, Nearest Neighbor model for clustering the features together. Supported options are 0 = brute_force (exact), 1 = ball_tree and 2 = lsh (both approximate).<br />
    * ccthreshold=xx, Threshold for running connected components to find clusters of similar images. Allowed values 0-&gt;1. The default ccthreshold is 0.96. This groups very similar images together, for example identical images or images that went<br />
        simple transformations like scaling, flip, zoom in. As higher the score the more similar images are grouped by and you will get                     smaller clusters. Score 0.9 is pretty broad and will clsuter images together even if they fine details are not similar.                     It is recommended to experiment with this parameter based on your dataset and then visualize the results using <code>fastdup.create_components_gallery()</code>.<br />
    * run_cc=0|1 run connected components on the resulting similarity graph. Default is 1.<br />
    * run_pagerank=0|1 run pagerank on the resulting similarity graph. Default is 1.<br />
    * delete_tar=0|1 when working with tar files obtained from cloud storage delete the tar after download<br />
    * delete_img=0|1 when working with images obtained from cloud storage delete the image after download<br />
    * tar_only=0|1 run only on tar files and ignore images in folders. Default is 0.<br />
    * run_stats=0|1 compute image statistics. Default is 1.<br />
    * sync_s3_to_local=0|1 In case of using s3 bucket sync s3 to local folder to improve performance. Assumes there is enough local disk space to contain the dataDefault is 0.</p></td>
          <td>
                <code>&#39;nnmodel=0&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>distance</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Distance metric for the Nearest Neighbors algorithm. The default is 'cosine' which works well in most cases.<br />
For nn_provider='nnf' the following distance metrics are supported.<br />
When using nnf_mode='Flat': 'cosine', 'euclidean', 'l1','linf','canberra','braycurtis','jensenshannon' are supported.<br />
Otherwise 'cosine' and 'euclidean' are supported.<br />
When using nn_provider='turi' the following distance metrics are supported. 'euclidean', 'cosine', 'manhattan', 'squared_euclidean'.</p></td>
          <td>
                <code>&#39;cosine&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Similarity measure in the range 0-&gt;1, where 1 is totally identical, 0.98 and above is almost identical.</p></td>
          <td>
                <code>0.9</code>
          </td>
        </tr>
        <tr>
          <td><code>lower_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Similarity percentile measure to outline images that are far away (outliers) vs. the total distribution. (means 5% out of the total similarities computed).</p></td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
        <tr>
          <td><code>model_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional location of ONNX model file, should not be used.</p></td>
          <td>
                <code>model_path_full</code>
          </td>
        </tr>
        <tr>
          <td><code>version</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Print out the version number. This function takes no argument.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>nearest_neighbors_k</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>For each image, how many similar images to look for.</p></td>
          <td>
                <code>2</code>
          </td>
        </tr>
        <tr>
          <td><code>d</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Length of the feature vector. On default it is 576. When you use your own onnx model, change this parameter to the output model feature vector length.</p></td>
          <td>
                <code>576</code>
          </td>
        </tr>
        <tr>
          <td><code>run_mode</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p><mark>run_mode=0</mark> (the default) does the feature extraction and NN embedding to compute all pairs similarities.<br />
It uses the input_dir command line argument for finding the directory to run on (or a list of files to run on).<br />
The features are extracted and saved into the working_dir path (the default features out file nme is<br />
<code>features.dat</code> in the same folder for storing the numpy features and features.dat.csv for storing the<br />
image file names corresponding to the numpy features).<br />
For larger dataset it may be wise to split the run into two, to make sure intermediate results are stored in case you encounter an error.                        <mark>run_mode=1</mark> computes the extracted features and stores them, does not compute the NN embedding.<br />
For large datasets, it is possible to run on a few computing nodes, to extract the features, in parallel.<br />
Use the min_offset and max_offset flags to allocate a subset of the images for each computing node.<br />
Offsets start from 0 to n-1 where n is the number of images in the input_dir folder.                        <mark>run_mode=2</mark> reads a stored feature file and computes the NN embedding to provide similarities.<br />
The input_dir param is ignored, and the work_dir is used to point to the numpy feature file. (Give a full path and filename).                        <mark>run_mode=3</mark> Reads the NN model stored by nnf.index from the work_dir and computes all pairs similarity on all images<br />
given by the test_dir parameter. input_dir should point to the location of the train data.<br />
This mode is used for scoring similarities on a new test dataset given a precomputed simiarity index on a train dataset.                        <mark>run_mode=4</mark> reads the NN model stored by <code>nnf.index</code> from the <code>work_dir</code> and computes all pairs similarity on pre extracted feature vectors computer by run_mode=1.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>nn_provider</code></td>
          <td>
                <code>string</code>
          </td>
          <td><p>Provider of the nearest neighbor algorithm, allowed values are turi|nnf. Default is nnf.</p></td>
          <td>
                <code>&#39;nnf&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>min_offset</code></td>
          <td>
                <code>unsigned long long</code>
          </td>
          <td><p>Optional min offset to start iterating on the full file list.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>max_offset</code></td>
          <td>
                <code>unsigned long long</code>
          </td>
          <td><p>Optional max offset to start iterating on the full file list.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>nnf_mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>When nn_provider='nnf' selects the nnf model mode.<br />
default is HSNW32. More accurate is Flat.</p></td>
          <td>
                <code>&#39;HNSW32&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>nnf_param</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>When nn_provider='nnf' selects assigns optional parameters.<br />
<mark>num_em_iter=XX</mark>, number of KMeans EM iterations to run. Default is 20.            <mark>num_clusters=XX</mark>, number of KMeans clusters to use. Default is 100.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>bounding_box</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional bouding box to crop images, given as bounding_box='rows=xx,cols=xx,height=xx,width=xx'.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>batch_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional batch size when computing inference. Allowed values &lt; 200. Note: batch_size &gt; 1 is enabled in the enterprise version.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>resume</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional flag to resume from a previous run.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>high_accuracy</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Compute a more accurate model. Runtime is increased about 15% and feature vector storage size/ memory is increased about 60%. The upside is the model can distinguish better of minute details in images with many objects.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>Status code 0 = success, 1 = error.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">input_dir</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>             
        <span class="n">work_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> 
        <span class="n">test_dir</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span>    
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>     
        <span class="n">num_threads</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>     
        <span class="n">num_images</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>        
        <span class="n">turi_param</span><span class="o">=</span><span class="s1">&#39;nnmodel=0&#39;</span><span class="p">,</span>  
        <span class="n">distance</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span>     <span class="c1">#distance metric for the nearest neighbor model.</span>
        <span class="n">threshold</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>         <span class="c1">#threshold for finding simiar images. (allowed values 0-&gt;1)</span>
        <span class="n">lower_threshold</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>   <span class="c1">#lower percentile threshold for finding simiar images (values 0-&gt;1)</span>
        <span class="n">model_path</span><span class="o">=</span><span class="n">model_path_full</span><span class="p">,</span>
        <span class="n">license</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>            <span class="c1">#license string</span>
        <span class="n">version</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>          <span class="c1">#show version and exit      </span>
        <span class="n">nearest_neighbors_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
        <span class="n">d</span><span class="o">=</span><span class="mi">576</span><span class="p">,</span>
        <span class="n">run_mode</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">nn_provider</span><span class="o">=</span><span class="s1">&#39;nnf&#39;</span><span class="p">,</span>
        <span class="n">min_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> 
        <span class="n">nnf_mode</span><span class="o">=</span><span class="s2">&quot;HNSW32&quot;</span><span class="p">,</span>
        <span class="n">nnf_param</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">bounding_box</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">resume</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">high_accuracy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run fastdup tool for finding duplicate, near duplicates, outliers and clusters of related images in a corpus of images.</span>
<span class="sd">    The only mandatory argument is image_dir.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_dir (str):</span>
<span class="sd">            Location of the images/videos to analyze.</span>
<span class="sd">                * A folder</span>
<span class="sd">                * A remote folder (s3 or minio starting with s3:// or minio://). When using minio append the minio server name for example minio://google/visual_db/sku110k.</span>
<span class="sd">                * A file containing absolute filenames each on its own row.</span>
<span class="sd">                * A file containing s3 full paths or minio paths each on its own row.</span>
<span class="sd">                * A python list with absolute filenames</span>
<span class="sd">                * yolov5 yaml input file containing train and test folders (single folder supported for now)</span>
<span class="sd">                * We support jpg, jpeg, tiff, tif, giff, png, mp4, avi. In addition we support tar, tar.gz, tgz and zip files containing images.</span>
<span class="sd">            If you have other image extensions that are readable by opencv imread() you can give them in a file (each image on its own row) and then we do not check for the</span>
<span class="sd">            known extensions and use opencv to read those formats.</span>
<span class="sd">            Note: It is not possible to mix compressed (videos or tars/zips) and regular images. Use the flag turi_param=&#39;tar_only=1&#39; if you want to ignore images and run from compressed files.</span>
<span class="sd">            Note: We assume image sizes should be larger than 10x10 pixels. Smaller images will be ignored with a warning shown.</span>
<span class="sd">            Note: It is possible to skip small images also by defining minimum allowed file size using turi_param=&#39;min_file_size=1000&#39; (in bytes).</span>
<span class="sd">            Note: For performance reasons it is always preferred to copy s3 images from s3 to local disk and then run fastdup on local disk. Since copying images from s3 in a loop is very slow.</span>
<span class="sd">            Alternatively you can use the flag turi_param=&#39;sync_s3_to_local=1&#39; to copy ahead all images on the remote s3 bucket to disk.</span>

<span class="sd">        work_dir (str): Optional path for storing intermediate files and results.</span>

<span class="sd">        test_dir (str): Optional path for test data. When given similarity of train and test images is compared (vs. train/train or test/test which are not performed).</span>
<span class="sd">            The following options are supported.</span>
<span class="sd">                * test_dir can be a local folder path</span>
<span class="sd">                * An s3:// or minio:// path.</span>
<span class="sd">                * A python list with absolute filenames</span>
<span class="sd">                * A file containing absolute filenames each on its own row.</span>

<span class="sd">        compute (str): Compute type [cpu|gpu] Note: gpu is supported only in the enterprise version.</span>

<span class="sd">        verbose (boolean): Verbosity.</span>

<span class="sd">        num_threads (int): Number of threads. If no value is specified num threads is auto configured by the number of cores.</span>

<span class="sd">        num_images (unsigned long long): Number of images to run on. On default, run on all the images in the image_dir folder.</span>

<span class="sd">        turi_param (str): Optional turi parameters seperated by command. Example run: turi_param=&#39;nnmodel=0,ccthreshold=0.99&#39;</span>
<span class="sd">            The following parameters are supported.</span>
<span class="sd">                * nnmodel=xx, Nearest Neighbor model for clustering the features together. Supported options are 0 = brute_force (exact), 1 = ball_tree and 2 = lsh (both approximate).</span>
<span class="sd">                * ccthreshold=xx, Threshold for running connected components to find clusters of similar images. Allowed values 0-&gt;1. The default ccthreshold is 0.96. This groups very similar images together, for example identical images or images that went</span>
<span class="sd">                    simple transformations like scaling, flip, zoom in. As higher the score the more similar images are grouped by and you will get \</span>
<span class="sd">                    smaller clusters. Score 0.9 is pretty broad and will clsuter images together even if they fine details are not similar. \</span>
<span class="sd">                    It is recommended to experiment with this parameter based on your dataset and then visualize the results using `fastdup.create_components_gallery()`.</span>
<span class="sd">                * run_cc=0|1 run connected components on the resulting similarity graph. Default is 1.</span>
<span class="sd">                * run_pagerank=0|1 run pagerank on the resulting similarity graph. Default is 1.</span>
<span class="sd">                * delete_tar=0|1 when working with tar files obtained from cloud storage delete the tar after download</span>
<span class="sd">                * delete_img=0|1 when working with images obtained from cloud storage delete the image after download</span>
<span class="sd">                * tar_only=0|1 run only on tar files and ignore images in folders. Default is 0.</span>
<span class="sd">                * run_stats=0|1 compute image statistics. Default is 1.</span>
<span class="sd">                * sync_s3_to_local=0|1 In case of using s3 bucket sync s3 to local folder to improve performance. Assumes there is enough local disk space to contain the dataDefault is 0.\</span>


<span class="sd">        distance (str): Distance metric for the Nearest Neighbors algorithm. The default is &#39;cosine&#39; which works well in most cases.</span>
<span class="sd">            For nn_provider=&#39;nnf&#39; the following distance metrics are supported.</span>
<span class="sd">            When using nnf_mode=&#39;Flat&#39;: &#39;cosine&#39;, &#39;euclidean&#39;, &#39;l1&#39;,&#39;linf&#39;,&#39;canberra&#39;,&#39;braycurtis&#39;,&#39;jensenshannon&#39; are supported.</span>
<span class="sd">            Otherwise &#39;cosine&#39; and &#39;euclidean&#39; are supported.</span>
<span class="sd">            When using nn_provider=&#39;turi&#39; the following distance metrics are supported. &#39;euclidean&#39;, &#39;cosine&#39;, &#39;manhattan&#39;, &#39;squared_euclidean&#39;.</span>

<span class="sd">        threshold (float): Similarity measure in the range 0-&gt;1, where 1 is totally identical, 0.98 and above is almost identical.</span>

<span class="sd">        lower_threshold (float): Similarity percentile measure to outline images that are far away (outliers) vs. the total distribution. (means 5% out of the total similarities computed).</span>

<span class="sd">        model_path (str): Optional location of ONNX model file, should not be used.</span>

<span class="sd">        version (bool): Print out the version number. This function takes no argument.</span>

<span class="sd">        nearest_neighbors_k (int): For each image, how many similar images to look for.</span>

<span class="sd">        d (int): Length of the feature vector. On default it is 576. When you use your own onnx model, change this parameter to the output model feature vector length.</span>

<span class="sd">        run_mode (int):</span>
<span class="sd">            ==run_mode=0== (the default) does the feature extraction and NN embedding to compute all pairs similarities.</span>
<span class="sd">            It uses the input_dir command line argument for finding the directory to run on (or a list of files to run on).</span>
<span class="sd">            The features are extracted and saved into the working_dir path (the default features out file nme is</span>
<span class="sd">            `features.dat` in the same folder for storing the numpy features and features.dat.csv for storing the</span>
<span class="sd">            image file names corresponding to the numpy features).</span>
<span class="sd">            For larger dataset it may be wise to split the run into two, to make sure intermediate results are stored in case you encounter an error.\</span>
<span class="sd">            \</span>
<span class="sd">            ==run_mode=1== computes the extracted features and stores them, does not compute the NN embedding.</span>
<span class="sd">            For large datasets, it is possible to run on a few computing nodes, to extract the features, in parallel.</span>
<span class="sd">            Use the min_offset and max_offset flags to allocate a subset of the images for each computing node.</span>
<span class="sd">            Offsets start from 0 to n-1 where n is the number of images in the input_dir folder.\</span>
<span class="sd">            \</span>
<span class="sd">            ==run_mode=2== reads a stored feature file and computes the NN embedding to provide similarities.</span>
<span class="sd">            The input_dir param is ignored, and the work_dir is used to point to the numpy feature file. (Give a full path and filename).\</span>
<span class="sd">            \</span>
<span class="sd">            ==run_mode=3== Reads the NN model stored by nnf.index from the work_dir and computes all pairs similarity on all images</span>
<span class="sd">            given by the test_dir parameter. input_dir should point to the location of the train data.</span>
<span class="sd">            This mode is used for scoring similarities on a new test dataset given a precomputed simiarity index on a train dataset.\</span>
<span class="sd">            \</span>
<span class="sd">            ==run_mode=4== reads the NN model stored by `nnf.index` from the `work_dir` and computes all pairs similarity on pre extracted feature vectors computer by run_mode=1.\</span>

<span class="sd">        nn_provider (string): Provider of the nearest neighbor algorithm, allowed values are turi|nnf. Default is nnf.</span>

<span class="sd">        min_offset (unsigned long long): Optional min offset to start iterating on the full file list.</span>

<span class="sd">        max_offset (unsigned long long): Optional max offset to start iterating on the full file list.</span>

<span class="sd">        nnf_mode (str): When nn_provider=&#39;nnf&#39; selects the nnf model mode.</span>
<span class="sd">            default is HSNW32. More accurate is Flat.</span>

<span class="sd">        nnf_param (str): When nn_provider=&#39;nnf&#39; selects assigns optional parameters.</span>
<span class="sd">            ==num_em_iter=XX==, number of KMeans EM iterations to run. Default is 20.\</span>
<span class="sd">            ==num_clusters=XX==, number of KMeans clusters to use. Default is 100.\</span>

<span class="sd">        bounding_box (str): Optional bouding box to crop images, given as bounding_box=&#39;rows=xx,cols=xx,height=xx,width=xx&#39;.</span>

<span class="sd">        batch_size (int): Optional batch size when computing inference. Allowed values &lt; 200. Note: batch_size &gt; 1 is enabled in the enterprise version.</span>

<span class="sd">        resume (int): Optional flag to resume from a previous run.</span>

<span class="sd">        high_accuracy (bool): Compute a more accurate model. Runtime is increased about 15% and feature vector storage size/ memory is increased about 60%. The upside is the model can distinguish better of minute details in images with many objects.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (int): Status code 0 = success, 1 = error.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FastDup Software, (C) copyright 2022 Dr. Amir Alush and Dr. Danny Bickson.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;sync_s3_to_local=1&#39;</span> <span class="ow">in</span> <span class="n">turi_param</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">input_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;s3://&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">input_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;minio://&#39;</span><span class="p">),</span> <span class="s1">&#39;sync_s3_to_local=1 can only be used with s3:// or minio:// input_dir&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;delete_img=1&#39;</span> <span class="ow">in</span> <span class="n">turi_param</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: delete_img=1 is not supported with sync_s3_to_local=1, please delete images manually from the work_dir after their download&#39;</span><span class="p">)</span>
            <span class="n">turi_param</span> <span class="o">=</span> <span class="n">turi_param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;delete_img=1&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;delete_img=0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">turi_param</span><span class="p">:</span>
            <span class="n">turi_param</span> <span class="o">+=</span> <span class="s1">&#39;,delete_img=0&#39;</span>

    <span class="n">input_dir2</span> <span class="o">=</span> <span class="n">input_dir</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">input_dir2</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;input_dir&quot;</span><span class="p">:</span> <span class="n">input_dir2</span><span class="p">,</span> <span class="s2">&quot;work_dir&quot;</span><span class="p">:</span> <span class="n">work_dir</span><span class="p">,</span> <span class="s2">&quot;test_dir&quot;</span><span class="p">:</span> <span class="n">test_dir</span><span class="p">,</span> <span class="s2">&quot;compute&quot;</span><span class="p">:</span> <span class="n">compute</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="n">verbose</span><span class="p">,</span> <span class="s2">&quot;num_threads&quot;</span><span class="p">:</span> <span class="n">num_threads</span><span class="p">,</span>
              <span class="s2">&quot;num_images&quot;</span><span class="p">:</span> <span class="n">num_images</span><span class="p">,</span> <span class="s2">&quot;turi_param&quot;</span><span class="p">:</span> <span class="n">turi_param</span><span class="p">,</span> <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="n">distance</span><span class="p">,</span> <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span> <span class="s2">&quot;lower_threshold&quot;</span><span class="p">:</span> <span class="n">lower_threshold</span><span class="p">,</span>
              <span class="s2">&quot;model_path&quot;</span><span class="p">:</span> <span class="n">model_path</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span> <span class="s2">&quot;nearest_neighbors_k&quot;</span><span class="p">:</span> <span class="n">nearest_neighbors_k</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">:</span> <span class="n">d</span><span class="p">,</span> <span class="s2">&quot;run_mode&quot;</span><span class="p">:</span> <span class="n">run_mode</span><span class="p">,</span>
              <span class="s2">&quot;nn_provider&quot;</span><span class="p">:</span> <span class="n">nn_provider</span><span class="p">,</span> <span class="s2">&quot;min_offset&quot;</span><span class="p">:</span> <span class="n">min_offset</span><span class="p">,</span> <span class="s2">&quot;max_offset&quot;</span><span class="p">:</span> <span class="n">max_offset</span><span class="p">,</span> <span class="s2">&quot;nnf_mode&quot;</span><span class="p">:</span> <span class="n">nnf_mode</span><span class="p">,</span> <span class="s2">&quot;nnf_param&quot;</span><span class="p">:</span> <span class="n">nnf_param</span><span class="p">,</span>
              <span class="s2">&quot;bounding_box&quot;</span><span class="p">:</span> <span class="n">bounding_box</span><span class="p">,</span> <span class="s2">&quot;batch_size&quot;</span><span class="p">:</span> <span class="n">batch_size</span><span class="p">,</span> <span class="s2">&quot;resume&quot;</span><span class="p">:</span> <span class="n">resume</span><span class="p">,</span> <span class="s2">&quot;high_accuracy&quot;</span><span class="p">:</span> <span class="n">high_accuracy</span><span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">work_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">)):</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">work_dir</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">input_dir</span><span class="p">})</span>
        <span class="n">files</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;files.txt&#39;</span><span class="p">)</span>
        <span class="n">input_dir</span> <span class="o">=</span> <span class="s1">&#39;files.txt&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">input_dir</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">run_mode</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found an empty input directory, please point to the directory where you are images are found&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">input_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">):</span>
        <span class="n">input_dir</span> <span class="o">=</span> <span class="n">input_dir</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>

    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">work_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">cwd</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">)):</span>
        <span class="n">work_dir</span> <span class="o">=</span> <span class="n">work_dir</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">cwd</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">work_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s2">/config.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: error writing config file: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2"> to file </span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s2">/config.json&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">version</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This software is free for non-commercial and academic usage under the Creative Common Attribution-NonCommercial-NoDerivatives 4.0 &quot;</span>
                <span class="s2">&quot;International license. Please reach out to </span><span class="si">%s</span><span class="s2"> for licensing options.&quot;</span><span class="p">,</span> <span class="n">CONTACT_EMAIL</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span>



    <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">input_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">input_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;s3://&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">input_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;minio://&#39;</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to find input dir&quot;</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot; please check your input&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">input_dir</span><span class="p">)</span> <span class="o">==</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">work_dir</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Input and work_dir output directories are the same, please point to different directories&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">resume</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="s1">&#39;atrain_features.dat&#39;</span><span class="p">))</span> <span class="ow">or</span> \
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">FILENAME_FEATURES</span><span class="p">)))</span>  <span class="ow">and</span> <span class="p">(</span><span class="n">run_mode</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">run_mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Found existing atrain_features.dat file in the working directory, please remove it before running the program or run in a fresh directory.&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;If you like to resume a previously stopped run, please run with resume=1.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">assert</span> <span class="n">nn_provider</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;turi&#39;</span><span class="p">,</span><span class="s1">&#39;nnf&#39;</span><span class="p">],</span> <span class="s2">&quot;Nearest neighbor implementation should be either turi or nnf.&quot;</span>
    <span class="k">if</span> <span class="n">nn_provider</span> <span class="o">==</span> <span class="s1">&#39;nnf&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nnf_mode</span> <span class="o">==</span> <span class="s2">&quot;Flat&quot;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">distance</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="s1">&#39;l1&#39;</span><span class="p">,</span><span class="s1">&#39;linf&#39;</span><span class="p">,</span><span class="s1">&#39;canberra&#39;</span><span class="p">,</span><span class="s1">&#39;braycurtis&#39;</span><span class="p">,</span><span class="s1">&#39;jensenshannon&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Distance metric </span><span class="si">{</span><span class="n">distance</span><span class="si">}</span><span class="s2"> not supported for nnf provider nnf when nnf_mode=Flat&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">distance</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">],</span> <span class="s2">&quot;Distance should be either euclidean or cosine when nn_provider=&#39;nnf&#39;&quot;</span>
    <span class="k">elif</span> <span class="n">nn_provider</span> <span class="o">==</span> <span class="s1">&#39;turi&#39;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">distance</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;euclidean&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="s1">&#39;manhattan&#39;</span><span class="p">,</span> <span class="s1">&#39;squared_euclidean&#39;</span><span class="p">],</span> <span class="s2">&quot;Distance should be either euclidean, cosine, manhattan or squared_euclidean when nn_provider=&#39;turi&#39;&quot;</span>


    <span class="k">if</span> <span class="p">(</span><span class="n">run_mode</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">FILENAME_NNF_INDEX</span><span class="p">))):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;An </span><span class="si">{</span><span class="n">FILENAME_NNF_INDEX</span><span class="si">}</span><span class="s2"> file is required for run_mode=3, please run with run_mode=0 to generate this file&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="c1"># support for YOLO dataset format</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">input_dir</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.yaml&#39;</span><span class="p">)):</span>
        <span class="kn">import</span> <span class="nn">yaml</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Detected yolo config file&#39;</span><span class="p">)</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
                <span class="k">if</span> <span class="s1">&#39;path&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">or</span> <span class="s1">&#39;train&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Failed to find path or train in yolo config file&#39;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Train location folder list is not supported, please create a single train folder&#39;</span><span class="p">)</span>
                <span class="c1"># Train/val/test sets as 1) dir: path/to/imgs, 2) file: path/to/imgs.txt, or 3) list: [path/to/imgs1, path/to/imgs2, ..]</span>
                <span class="c1">#path: ../datasets/coco128  # dataset root dir</span>
                <span class="c1">#train: images/train2017  # train images (relative to &#39;path&#39;) 128 images</span>
                <span class="c1">#val: images/train2017  # val images (relative to &#39;path&#39;) 128 images</span>
                <span class="c1">#test:  # test images (optional)</span>
                <span class="n">input_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="s1">&#39;test&#39;</span> <span class="ow">in</span> <span class="n">config</span> <span class="ow">and</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">test_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">])</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error when loading yolo .yaml config&#39;</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
                <span class="k">return</span> <span class="mi">1</span>


    <span class="k">if</span> <span class="n">batch_size</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">batch_size</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Allowed values for batch size 1-&gt;200.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">test_dir</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;filenames&#39;</span><span class="p">:</span><span class="n">test_dir</span><span class="p">})</span>
        <span class="n">files</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">INPUT_TEST_FILE_LOCATION</span><span class="p">)</span>
        <span class="n">test_dir</span> <span class="o">=</span> <span class="n">INPUT_TEST_FILE_LOCATION</span>


    <span class="k">if</span> <span class="p">(</span><span class="n">run_mode</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">test_dir</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For run_mode=3 test_dir parameter needs to point to the location of the test batch of images compred to the train images&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">run_mode</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">run_mode</span> <span class="o">==</span> <span class="mi">6</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="s2">&quot;nnf.index&quot;</span><span class="p">)):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: Failed to find stored model nnf.index on </span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">high_accuracy</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">model_path</span> <span class="o">!=</span>  <span class="n">model_path_full</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: Can not run high accuracy model when using user provided model_path&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="n">DEFAULT_MODEL_FEATURE_WIDTH</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Can not run high accuracy model when using user provided d&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="n">model_path</span> <span class="o">=</span> <span class="n">model_path_full</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;l.ort&#39;</span><span class="p">,</span> <span class="s1">&#39;l2.ort&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">HIGH_ACCURACY_MODEL_FEATURE_WIDTH</span>

    <span class="c1"># When working with s3 remote folder allow loading it first to disk to improve performance</span>
    <span class="k">if</span> <span class="s1">&#39;sync_s3_to_local=1&#39;</span> <span class="ow">in</span> <span class="n">turi_param</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">input_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;s3://&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">input_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;minio://&#39;</span><span class="p">),</span> <span class="s1">&#39;sync_s3_to_local=1 can only be used with s3:// or minio:// input_dir&#39;</span>
        <span class="k">if</span> <span class="s1">&#39;delete_img=1&#39;</span> <span class="ow">in</span> <span class="n">turi_param</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: delete_img=1 is not supported with sync_s3_to_local=1, please delete images manually from the work_dir after their download&#39;</span><span class="p">)</span>
            <span class="n">turi_param</span> <span class="o">=</span> <span class="n">turi_param</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;delete_img=1&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;delete_img=0&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">turi_param</span><span class="p">:</span>
            <span class="n">turi_param</span> <span class="o">+=</span> <span class="s1">&#39;,delete_img=0&#39;</span>
        <span class="n">input_dir</span> <span class="o">=</span> <span class="n">download_from_s3</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">test_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;s3://&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">test_dir</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;minio://&#39;</span><span class="p">):</span>
            <span class="n">test_dir</span> <span class="o">=</span> <span class="n">download_from_s3</span><span class="p">(</span><span class="n">test_dir</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">,</span> <span class="n">verbose</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="n">local_error_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">FILENAME_ERROR_MSG</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_error_file</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">local_error_file</span><span class="p">)</span>

    <span class="c1">#Calling the C++ side</span>
    <span class="n">dll</span><span class="o">.</span><span class="n">do_main</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">c_int</span>
    <span class="n">dll</span><span class="o">.</span><span class="n">do_main</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_char_p</span><span class="p">,</span> 
            <span class="n">c_char_p</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">,</span>
            <span class="n">c_bool</span><span class="p">,</span>
            <span class="n">c_int</span><span class="p">,</span>
            <span class="n">c_ulonglong</span><span class="p">,</span> 
            <span class="n">c_char_p</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">,</span>
            <span class="n">c_float</span><span class="p">,</span>
            <span class="n">c_float</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">,</span>
            <span class="n">c_bool</span><span class="p">,</span>
            <span class="n">c_int</span><span class="p">,</span>
            <span class="n">c_int</span><span class="p">,</span>
            <span class="n">c_int</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">,</span>
            <span class="n">c_ulonglong</span><span class="p">,</span>
            <span class="n">c_ulonglong</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">,</span>
            <span class="n">c_char_p</span><span class="p">,</span> 
            <span class="n">c_char_p</span><span class="p">,</span>
            <span class="n">c_int</span><span class="p">,</span>
            <span class="n">c_int</span><span class="p">]</span>

    <span class="n">cm</span> <span class="o">=</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">nullcontext</span><span class="p">()</span>

    <span class="k">if</span> <span class="s1">&#39;JPY_PARENT_PID&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">IPython</span> <span class="kn">import</span> <span class="n">get_ipython</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">get_ipython</span><span class="p">()</span>
            <span class="n">extension</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="n">extension_manager</span><span class="o">.</span><span class="n">loaded</span>
            <span class="k">if</span> <span class="s1">&#39;wurlitzer&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">extension</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">wurlitzer</span>
                <span class="n">cm</span> <span class="o">=</span> <span class="n">wurlitzer</span><span class="o">.</span><span class="n">sys_pipes</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;On Jupyter notebook running on large datasets, there may be delay getting the console output</span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;A recommended way to fixing this is to run: </span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;%pip install wurlitzer</span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;</span><span class="si">%lo</span><span class="s2">ad_ext wurlitzer</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">cm</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">dll</span><span class="o">.</span><span class="n">do_main</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">input_dir</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">test_dir</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">compute</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="n">verbose</span><span class="p">,</span>
        <span class="n">num_threads</span><span class="p">,</span>
        <span class="n">num_images</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">turi_param</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="n">threshold</span><span class="p">,</span>
        <span class="n">lower_threshold</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">license</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">model_path</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="n">version</span><span class="p">,</span>
        <span class="n">nearest_neighbors_k</span><span class="p">,</span>
        <span class="n">d</span><span class="p">,</span>
        <span class="n">run_mode</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">nn_provider</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="n">min_offset</span><span class="p">,</span>
        <span class="n">max_offset</span><span class="p">,</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">nnf_mode</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">nnf_param</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="nb">bytes</span><span class="p">(</span><span class="n">bounding_box</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
        <span class="n">batch_size</span><span class="p">,</span>
        <span class="n">resume</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="s1">&#39;JPY_PARENT_PID&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_error_file</span><span class="p">):</span>
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_error_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;fastdup C++ error received: &quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">return</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.run_kmeans</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.run_kmeans"></a>
  <div class="doc doc-contents first">
  
      <p>Run KMeans algorithm on a folder of images given by <code>input_dir</code> and save the results to <code>work_dir</code>.<br />
Fastdup will extract feature vectors using the model specified by <code>model_path</code> and then run KMeans to cluster the vectors.<br />
The results will be saved to <code>work_dir</code> in the following format:<br />
- <code>kmeans_centroids.csv</code>: a csv file containing the centroids of the clusters.<br />
- <code>kmeans_assignments.csv</code>: assignment of each data point to the closet centroids (number of centroids given by <code>nearest_neighbors_k</code>).<br />
After running kmeans you can use <code>create_kmeans_clusters_gallery</code> to view the results.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>path to the folder containing the images to be clustered. See <code>fastdup.run</code> for more details.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>path to the folder where the results will be saved.</p></td>
          <td>
                <code>&#39;.&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>verbosity level, default False</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>num_clusters</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of KMeans clusters to use</p></td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>num_em_iter</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of em iterations</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>num_threads</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of threads for performing the feature vector extraction</p></td>
          <td>
                <code>-1</code>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Limit the number of images</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>model_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Model path for the model to be used for feature vector extraction</p></td>
          <td>
                <code>model_path_full</code>
          </td>
        </tr>
        <tr>
          <td><code>license</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>License string</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>nearest_neighbors_k</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>When assigning an image into a cluster, how many clusters to assign to (starting from the closest)</p></td>
          <td>
                <code>2</code>
          </td>
        </tr>
        <tr>
          <td><code>d</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Dimension of the feature vector</p></td>
          <td>
                <code>576</code>
          </td>
        </tr>
        <tr>
          <td><code>bounding_box</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional bounding box see fastdup:::run for more details</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>high_accuracy</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Use higher accuracy model for the feature extraction</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, 1 in case of error</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_kmeans</span><span class="p">(</span><span class="n">input_dir</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="n">work_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
               <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">num_clusters</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
               <span class="n">num_em_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
               <span class="n">num_threads</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">num_images</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
               <span class="n">model_path</span><span class="o">=</span><span class="n">model_path_full</span><span class="p">,</span>
               <span class="n">license</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>            <span class="c1">#license string</span>
               <span class="n">nearest_neighbors_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">d</span><span class="o">=</span><span class="mi">576</span><span class="p">,</span>
               <span class="n">bounding_box</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">high_accuracy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run KMeans algorithm on a folder of images given by `input_dir` and save the results to `work_dir`.</span>
<span class="sd">    Fastdup will extract feature vectors using the model specified by `model_path` and then run KMeans to cluster the vectors.</span>
<span class="sd">    The results will be saved to `work_dir` in the following format:</span>
<span class="sd">    - `kmeans_centroids.csv`: a csv file containing the centroids of the clusters.</span>
<span class="sd">    - `kmeans_assignments.csv`: assignment of each data point to the closet centroids (number of centroids given by `nearest_neighbors_k`).</span>
<span class="sd">    After running kmeans you can use `create_kmeans_clusters_gallery` to view the results.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_dir (str): path to the folder containing the images to be clustered. See `fastdup.run` for more details.</span>
<span class="sd">        work_dir (str): path to the folder where the results will be saved.</span>
<span class="sd">        verbose (bool): verbosity level, default False</span>
<span class="sd">        num_clusters (int): Number of KMeans clusters to use</span>
<span class="sd">        num_em_iter (int): Number of em iterations</span>
<span class="sd">        num_threads (int): Number of threads for performing the feature vector extraction</span>
<span class="sd">        num_images (int): Limit the number of images</span>
<span class="sd">        model_path (str): Model path for the model to be used for feature vector extraction</span>
<span class="sd">        license (str): License string</span>
<span class="sd">        nearest_neighbors_k (int): When assigning an image into a cluster, how many clusters to assign to (starting from the closest)</span>
<span class="sd">        d (int): Dimension of the feature vector</span>
<span class="sd">        bounding_box (str): Optional bounding box see fastdup:::run for more details</span>
<span class="sd">        high_accuracy (bool): Use higher accuracy model for the feature extraction</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (int): 0 in case of success, 1 in case of error</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">num_clusters</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Number of clusters must be at least 2, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_clusters</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">num_em_iter</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Number of EM iterations must be at least 1, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_em_iter</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">input_dir</span><span class="o">=</span><span class="n">input_dir</span><span class="p">,</span>
                <span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
                <span class="n">num_images</span><span class="o">=</span><span class="n">num_images</span><span class="p">,</span>
                <span class="n">model_path</span><span class="o">=</span><span class="n">model_path</span><span class="p">,</span>
                <span class="n">license</span><span class="o">=</span><span class="n">license</span><span class="p">,</span>            <span class="c1">#license string</span>
                <span class="n">nearest_neighbors_k</span><span class="o">=</span><span class="n">nearest_neighbors_k</span><span class="p">,</span>
                <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
                <span class="n">run_mode</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
                <span class="n">nnf_param</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;num_clusters=</span><span class="si">{</span><span class="n">num_clusters</span><span class="si">}</span><span class="s2">,num_em_iter=</span><span class="si">{</span><span class="n">num_em_iter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">bounding_box</span><span class="o">=</span><span class="n">bounding_box</span><span class="p">,</span>
                <span class="n">high_accuracy</span><span class="o">=</span><span class="n">high_accuracy</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;run_kmeans&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;run_kmeans&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.run_kmeans_on_extracted</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.run_kmeans_on_extracted"></a>
  <div class="doc doc-contents first">
  
      <p>Run KMeans algorithm on a folder of extracted feature vectors (created on default when running fastdup:::run).<br />
The results will be saved to <code>work_dir</code> in the following format:<br />
- <code>kmeans_centroids.csv</code>: a csv file containing the centroids of the clusters. In each row one centroid. In total <code>num_clusters</code> rows.<br />
- <code>kmeans_assignments.csv</code>: assignment of each data point to the closet centroids (number of centroids given by <code>nearest_neighbors_k</code>). In each row the image filename is listed, centoid id (starting from zero) and the L2 distance to the centroid.<br />
After running kmeans you can use <code>fastdup:::create_kmeans_clusters_gallery</code> to view the results.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>path to the folder containing the images to be clustered. See fastup:::run for more details.</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>path to the folder where the results will be saved.</p></td>
          <td>
                <code>&#39;.&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>verbosity level, default False</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>num_clusters</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of KMeans clusters to use</p></td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>num_em_iter</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of em iterations</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>num_threads</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of threads for performing the feature vector extraction</p></td>
          <td>
                <code>-1</code>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Limit the number of images</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>model_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Model path for the model to be used for feature vector extraction</p></td>
          <td>
                <code>model_path_full</code>
          </td>
        </tr>
        <tr>
          <td><code>license</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>License string</p></td>
          <td>
                <code>&#39;&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>nearest_neighbors_k</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>When assigning an image into a cluster, how many clusters to assign to (starting from the closest)</p></td>
          <td>
                <code>2</code>
          </td>
        </tr>
        <tr>
          <td><code>d</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Dimension of the feature vector</p></td>
          <td>
                <code>576</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, 1 in case of error</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_kmeans_on_extracted</span><span class="p">(</span><span class="n">input_dir</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
               <span class="n">work_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>
               <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
               <span class="n">num_clusters</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
               <span class="n">num_em_iter</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
               <span class="n">num_threads</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
               <span class="n">num_images</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
               <span class="n">model_path</span><span class="o">=</span><span class="n">model_path_full</span><span class="p">,</span>
               <span class="n">license</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>            <span class="c1">#license string</span>
               <span class="n">nearest_neighbors_k</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
               <span class="n">d</span><span class="o">=</span><span class="mi">576</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run KMeans algorithm on a folder of extracted feature vectors (created on default when running fastdup:::run).</span>
<span class="sd">    The results will be saved to `work_dir` in the following format:</span>
<span class="sd">    - `kmeans_centroids.csv`: a csv file containing the centroids of the clusters. In each row one centroid. In total `num_clusters` rows.</span>
<span class="sd">    - `kmeans_assignments.csv`: assignment of each data point to the closet centroids (number of centroids given by `nearest_neighbors_k`). In each row the image filename is listed, centoid id (starting from zero) and the L2 distance to the centroid.</span>
<span class="sd">    After running kmeans you can use `fastdup:::create_kmeans_clusters_gallery` to view the results.</span>

<span class="sd">    Args:</span>
<span class="sd">        input_dir (str): path to the folder containing the images to be clustered. See fastup:::run for more details.</span>
<span class="sd">        work_dir (str): path to the folder where the results will be saved.</span>
<span class="sd">        verbose (bool): verbosity level, default False</span>
<span class="sd">        num_clusters (int): Number of KMeans clusters to use</span>
<span class="sd">        num_em_iter (int): Number of em iterations</span>
<span class="sd">        num_threads (int): Number of threads for performing the feature vector extraction</span>
<span class="sd">        num_images (int): Limit the number of images</span>
<span class="sd">        model_path (str): Model path for the model to be used for feature vector extraction</span>
<span class="sd">        license (str): License string</span>
<span class="sd">        nearest_neighbors_k (int): When assigning an image into a cluster, how many clusters to assign to (starting from the closest)</span>
<span class="sd">        d (int): Dimension of the feature vector</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (int): 0 in case of success, 1 in case of error</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">num_clusters</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Number of clusters must be at least 2, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_clusters</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">num_em_iter</span> <span class="o">&gt;=</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Number of EM iterations must be at least 1, got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">num_em_iter</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">input_dir</span><span class="o">=</span><span class="n">input_dir</span><span class="p">,</span>
                   <span class="n">work_dir</span><span class="o">=</span><span class="n">work_dir</span><span class="p">,</span>
                   <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                   <span class="n">num_threads</span><span class="o">=</span><span class="n">num_threads</span><span class="p">,</span>
                   <span class="n">num_images</span><span class="o">=</span><span class="n">num_images</span><span class="p">,</span>
                   <span class="n">model_path</span><span class="o">=</span><span class="n">model_path</span><span class="p">,</span>
                   <span class="n">license</span><span class="o">=</span><span class="n">license</span><span class="p">,</span>            <span class="c1">#license string</span>
                   <span class="n">nearest_neighbors_k</span><span class="o">=</span><span class="n">nearest_neighbors_k</span><span class="p">,</span>
                   <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">,</span>
                   <span class="n">run_mode</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                   <span class="n">nnf_param</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;num_clusters=</span><span class="si">{</span><span class="n">num_clusters</span><span class="si">}</span><span class="s2">,num_em_iter=</span><span class="si">{</span><span class="n">num_em_iter</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;run_kmeans_on_extracted&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;run_kmeans_on_extracted&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 id="fastdup-visualization-of-results">Fastdup visualization of results</h2>
<p>Visualization of the output data is done using the following functions:</p>
<p><code>fastdup.create_duplicates_gallery</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_duplicates_gallery"></a>
  <div class="doc doc-contents first">
  
      <p>Function to create and display a gallery of images computed by the similarity metrics</p>

<details class="example">
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import fastdup<br />
fastdup.run('input_folder', 'output_folder')<br />
fastdup.create_duplicates_gallery('output_folder', save_path='.', get_label_func = lambda x: x.split('/')[1], slice='hamburger')</p>
</blockquote>
</blockquote>
</blockquote>
</details>      <p>Regarding get_label_func, this example assumes that the second folder name is the class name for example my_data/hamburger/image001.jpg. You can change it to match your own labeling convention.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>similarity_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>csv file with the computed similarities by the fastdup tool, or a work_dir path, or a pandas dataframe containing the similarities.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>output folder location for the visuals</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>descending</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If False, print the similarities from the least similar to the most similar. Default is True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>lazy_load</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>slice</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.<br />
slice could be a specific label i.e. slice='haumburger' and in that case only similarities between hamburger and other classes are presented.<br />
Two reserved arguments for slice are "diff" and "same". When using "diff" the report only shows similarities between classes. When using "same" the report will show only similarities inside same class.<br />
Note that when using slice, the function get_label_function should be implmeneted.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to set the max width of the gallery.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_bounding_box_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow plotting bounding boxes on top of the image.<br />
The input is an absolute path to the image and the output is a list of bounding boxes.<br />
Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_reformat_filename_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow changing the presented filename into another string.<br />
The input is an absolute path to the image and the output is the string to display instead of the filename.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_extra_col_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow adding additional column to the report</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to specify the input directory of webdataset tar files,<br />
in case when working with webdataset tar files where the image was deleted after run using turi_param='delete_img=1'</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to specify fastdup work_dir, when using a pd.DataFrame instead of a duplicate file path</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Optional parameter to specify the threshold for similarity score to be considered as duplicate. Values above the threshold will be considered as duplicate.<br />
Allowed values are between 0 and 1.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>save_artifacts</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>Optional parameter to allow saving the intermediate artifacts (raw images, csv with results) to the output folder</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_duplicates_gallery</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">lazy_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">get_bounding_box_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_reformat_filename_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Function to create and display a gallery of images computed by the similarity metrics</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import fastdup</span>
<span class="sd">        &gt;&gt;&gt; fastdup.run(&#39;input_folder&#39;, &#39;output_folder&#39;)</span>
<span class="sd">        &gt;&gt;&gt; fastdup.create_duplicates_gallery(&#39;output_folder&#39;, save_path=&#39;.&#39;, get_label_func = lambda x: x.split(&#39;/&#39;)[1], slice=&#39;hamburger&#39;)</span>

<span class="sd">    Regarding get_label_func, this example assumes that the second folder name is the class name for example my_data/hamburger/image001.jpg. You can change it to match your own labeling convention.</span>


<span class="sd">    Args:</span>
<span class="sd">        similarity_file (str): csv file with the computed similarities by the fastdup tool, or a work_dir path, or a pandas dataframe containing the similarities.</span>

<span class="sd">        save_path (str): output folder location for the visuals</span>

<span class="sd">        num_images (int): Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</span>

<span class="sd">        descending (boolean): If False, print the similarities from the least similar to the most similar. Default is True.</span>

<span class="sd">        lazy_load (boolean): If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        slice (str): Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</span>
<span class="sd">            slice could be a specific label i.e. slice=&#39;haumburger&#39; and in that case only similarities between hamburger and other classes are presented.</span>
<span class="sd">            Two reserved arguments for slice are &quot;diff&quot; and &quot;same&quot;. When using &quot;diff&quot; the report only shows similarities between classes. When using &quot;same&quot; the report will show only similarities inside same class.</span>
<span class="sd">            Note that when using slice, the function get_label_function should be implmeneted.</span>

<span class="sd">        max_width (int): Optional parameter to set the max width of the gallery.</span>

<span class="sd">        get_bounding_box_func (callable): Optional parameter to allow plotting bounding boxes on top of the image.</span>
<span class="sd">            The input is an absolute path to the image and the output is a list of bounding boxes.</span>
<span class="sd">            Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</span>

<span class="sd">        get_reformat_filename_func (callable): Optional parameter to allow changing the presented filename into another string.</span>
<span class="sd">            The input is an absolute path to the image and the output is the string to display instead of the filename.</span>

<span class="sd">        get_extra_col_func (callable): Optional parameter to allow adding additional column to the report</span>

<span class="sd">        input_dir (str): Optional parameter to specify the input directory of webdataset tar files,</span>
<span class="sd">            in case when working with webdataset tar files where the image was deleted after run using turi_param=&#39;delete_img=1&#39;</span>

<span class="sd">        work_dir (str): Optional parameter to specify fastdup work_dir, when using a pd.DataFrame instead of a duplicate file path</span>

<span class="sd">        threshold (float): Optional parameter to specify the threshold for similarity score to be considered as duplicate. Values above the threshold will be considered as duplicate.</span>
<span class="sd">            Allowed values are between 0 and 1.</span>

<span class="sd">        save_artifacts (boolean): Optional parameter to allow saving the intermediate artifacts (raw images, csv with results) to the output folder</span>

<span class="sd">   &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">check_params</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

        <span class="n">similarity_file</span><span class="p">,</span> <span class="n">input_dir</span> <span class="o">=</span> <span class="n">find_similarity_file</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>


        <span class="n">ret</span> <span class="o">=</span> <span class="n">do_create_duplicates_gallery</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">descending</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="p">,</span>
                                            <span class="n">get_reformat_filename_func</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_duplicates_gallery&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_duplicates_gallery&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.create_duplicate_videos_gallery</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_duplicate_videos_gallery"></a>
  <div class="doc doc-contents first">
  
      <p>Function to create and display a gallery of duplicaate videos computed by the similarity metrics</p>

<details class="example">
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import fastdup<br />
fastdup.run('input_folder', 'output_folder', run_mode=1)  # extract frames from videos<br />
fastdup.run('input_folder', 'output_folder', run_mode=2)  # run fastdup<br />
fastdup.create_duplicates_videos_gallery('output_folder', save_path='.')</p>
</blockquote>
</blockquote>
</blockquote>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>similarity_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>csv file with the computed similarities by the fastdup tool, or a work_dir path, or a pandas dataframe containing the similarities.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>output folder location for the visuals</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>descending</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If False, print the similarities from the least similar to the most similar. Default is True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>lazy_load</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>slice</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.<br />
slice could be a specific label i.e. slice='haumburger' and in that case only similarities between hamburger and other classes are presented.<br />
Two reserved arguments for slice are "diff" and "same". When using "diff" the report only shows similarities between classes. When using "same" the report will show only similarities inside same class.<br />
Note that when using slice, the function get_label_function should be implmeneted.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to set the max width of the gallery.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_bounding_box_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow plotting bounding boxes on top of the image.<br />
The input is an absolute path to the image and the output is a list of bounding boxes.<br />
Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_reformat_filename_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow changing the presented filename into another string.<br />
The input is an absolute path to the image and the output is the string to display instead of the filename.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_extra_col_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow adding additional column to the report</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to specify the input directory of webdataset tar files,<br />
in case when working with webdataset tar files where the image was deleted after run using turi_param='delete_img=1'</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to specify fastdup work_dir, when using a pd.DataFrame instead of a duplicate file path</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Optional parameter to specify the threshold for similarity score to be considered as duplicate. Values above the threshold will be considered as duplicate.<br />
Allowed values are between 0 and 1.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>save_artifacts</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>Optional parameter to allow saving the intermediate artifacts (raw images, csv with results) to the output folder</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_duplicate_videos_gallery</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                              <span class="n">lazy_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">get_bounding_box_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_reformat_filename_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">work_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Function to create and display a gallery of duplicaate videos computed by the similarity metrics</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import fastdup</span>
<span class="sd">        &gt;&gt;&gt; fastdup.run(&#39;input_folder&#39;, &#39;output_folder&#39;, run_mode=1)  # extract frames from videos</span>
<span class="sd">        &gt;&gt;&gt; fastdup.run(&#39;input_folder&#39;, &#39;output_folder&#39;, run_mode=2)  # run fastdup</span>
<span class="sd">        &gt;&gt;&gt; fastdup.create_duplicates_videos_gallery(&#39;output_folder&#39;, save_path=&#39;.&#39;)</span>


<span class="sd">    Args:</span>
<span class="sd">        similarity_file (str): csv file with the computed similarities by the fastdup tool, or a work_dir path, or a pandas dataframe containing the similarities.</span>

<span class="sd">        save_path (str): output folder location for the visuals</span>

<span class="sd">        num_images (int): Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</span>

<span class="sd">        descending (boolean): If False, print the similarities from the least similar to the most similar. Default is True.</span>

<span class="sd">        lazy_load (boolean): If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        slice (str): Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</span>
<span class="sd">            slice could be a specific label i.e. slice=&#39;haumburger&#39; and in that case only similarities between hamburger and other classes are presented.</span>
<span class="sd">            Two reserved arguments for slice are &quot;diff&quot; and &quot;same&quot;. When using &quot;diff&quot; the report only shows similarities between classes. When using &quot;same&quot; the report will show only similarities inside same class.</span>
<span class="sd">            Note that when using slice, the function get_label_function should be implmeneted.</span>

<span class="sd">        max_width (int): Optional parameter to set the max width of the gallery.</span>

<span class="sd">        get_bounding_box_func (callable): Optional parameter to allow plotting bounding boxes on top of the image.</span>
<span class="sd">            The input is an absolute path to the image and the output is a list of bounding boxes.</span>
<span class="sd">            Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</span>

<span class="sd">        get_reformat_filename_func (callable): Optional parameter to allow changing the presented filename into another string.</span>
<span class="sd">            The input is an absolute path to the image and the output is the string to display instead of the filename.</span>

<span class="sd">        get_extra_col_func (callable): Optional parameter to allow adding additional column to the report</span>

<span class="sd">        input_dir (str): Optional parameter to specify the input directory of webdataset tar files,</span>
<span class="sd">            in case when working with webdataset tar files where the image was deleted after run using turi_param=&#39;delete_img=1&#39;</span>

<span class="sd">        work_dir (str): Optional parameter to specify fastdup work_dir, when using a pd.DataFrame instead of a duplicate file path</span>

<span class="sd">        threshold (float): Optional parameter to specify the threshold for similarity score to be considered as duplicate. Values above the threshold will be considered as duplicate.</span>
<span class="sd">            Allowed values are between 0 and 1.</span>

<span class="sd">        save_artifacts (boolean): Optional parameter to allow saving the intermediate artifacts (raw images, csv with results) to the output folder</span>

<span class="sd">   &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">check_params</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">if</span> <span class="n">threshold</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">threshold</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;threshold should be between 0 and 1&quot;</span>

        <span class="k">if</span> <span class="n">work_dir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span>  <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">):</span>
                <span class="n">work_dir</span> <span class="o">=</span> <span class="n">similarity_file</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">work_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">))</span>

        <span class="n">df</span><span class="p">,</span> <span class="n">input_dir</span> <span class="o">=</span> <span class="n">find_similarity_file</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">]</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">remove_duplicate_video_distances</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;is_video&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">create_duplicates_gallery</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">descending</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="p">,</span>
                                                <span class="n">get_reformat_filename_func</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">work_dir</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_duplicates_gallery&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span> <span class="s2">&quot;create_duplicates_gallery&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.create_outliers_gallery</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_outliers_gallery"></a>
  <div class="doc doc-contents first">
  
      <p>Function to create and display a gallery of images computed by the outliers metrics.<br />
Outliers are computed using the fastdup tool, by embedding each image to a short feature vector, finding top k similar neighbors<br />
and finding images that are further away from all other images, i.e. outliers.<br />
On default fastdup saves the outliers into a file called <code>outliers.csv</code> inside the <code>work_dir</code> folder.<br />
It is possible to load this file using pandas to get the list of outlir images.<br />
Note that the number of images included in the outliers file depends on the <code>lower_threshold</code> parameter in the fastdup run. This command line argument is a percentile<br />
i.e. 0.05 means top 5% of the images that are further away from the rest of the images are considered outliers.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>outliers_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>csv file with the computed outliers by the fastdup tool, or a work_dir path, or a pandas dataframe contraining the outliers</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>output folder location for the visuals</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>lazy_load</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>how</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional outlier selection method. one = take the image that is far away from any one image (but may have other images close to it).<br />
                                          all = take the image that is far away from all other images. Default is one.</p></td>
          <td>
                <code>&#39;one&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>slice</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to set the max width of the gallery.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_bounding_box_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow plotting bounding boxes on top of the image.<br />
The input is an absolute path to the image and the output is a list of bounding boxes.<br />
Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_reformat_filename_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow changing the presented filename into another string.<br />
The input is an absolute path to the image and the output is the string to display instead of the filename.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_extra_col_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow adding additional column to the report</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to specify the input directory of webdataset tar files,<br />
in case when working with webdataset tar files where the image was deleted after run using turi_param='delete_img=1'</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_outliers_gallery</span><span class="p">(</span><span class="n">outliers_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lazy_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">how</span><span class="o">=</span><span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">get_reformat_filename_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_dir</span> <span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Function to create and display a gallery of images computed by the outliers metrics.</span>
<span class="sd">    Outliers are computed using the fastdup tool, by embedding each image to a short feature vector, finding top k similar neighbors</span>
<span class="sd">    and finding images that are further away from all other images, i.e. outliers.</span>
<span class="sd">    On default fastdup saves the outliers into a file called `outliers.csv` inside the `work_dir` folder.</span>
<span class="sd">    It is possible to load this file using pandas to get the list of outlir images.</span>
<span class="sd">    Note that the number of images included in the outliers file depends on the `lower_threshold` parameter in the fastdup run. This command line argument is a percentile</span>
<span class="sd">    i.e. 0.05 means top 5% of the images that are further away from the rest of the images are considered outliers.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        outliers_file (str): csv file with the computed outliers by the fastdup tool, or a work_dir path, or a pandas dataframe contraining the outliers</span>

<span class="sd">        save_path (str): output folder location for the visuals</span>

<span class="sd">        num_images (int): Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</span>

<span class="sd">        lazy_load (boolean): If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        how (str): Optional outlier selection method. one = take the image that is far away from any one image (but may have other images close to it).</span>
<span class="sd">                                                      all = take the image that is far away from all other images. Default is one.</span>

<span class="sd">        slice (str): Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</span>

<span class="sd">        max_width (int): Optional parameter to set the max width of the gallery.</span>

<span class="sd">        get_bounding_box_func (callable): Optional parameter to allow plotting bounding boxes on top of the image.</span>
<span class="sd">            The input is an absolute path to the image and the output is a list of bounding boxes.</span>
<span class="sd">            Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</span>

<span class="sd">        get_reformat_filename_func (callable): Optional parameter to allow changing the presented filename into another string.</span>
<span class="sd">            The input is an absolute path to the image and the output is the string to display instead of the filename.</span>

<span class="sd">        get_extra_col_func (callable): Optional parameter to allow adding additional column to the report</span>

<span class="sd">        input_dir (str): Optional parameter to specify the input directory of webdataset tar files,</span>
<span class="sd">            in case when working with webdataset tar files where the image was deleted after run using turi_param=&#39;delete_img=1&#39;</span>

<span class="sd">     &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">check_params</span><span class="p">(</span><span class="n">outliers_file</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outliers_file</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">outliers_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outliers_file</span><span class="p">),</span> <span class="s2">&quot;Failed to find outliers file &quot;</span> <span class="o">+</span> <span class="n">outliers_file</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">outliers_file</span><span class="p">):</span>
                <span class="n">outliers_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outliers_file</span><span class="p">,</span> <span class="n">FILENAME_OUTLIERS</span><span class="p">)</span>

            <span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">outliers_file</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">input_dir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>  <span class="ow">and</span> <span class="s1">&#39;input_dir&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="n">input_dir</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;input_dir&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wrong type of similarity file&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">outliers_file</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">1</span>


        <span class="k">assert</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;one&#39;</span> <span class="ow">or</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s2">&quot;Wrong argument to how=[one|all]&quot;</span>

        <span class="n">ret</span><span class="o">=</span> <span class="n">do_create_outliers_gallery</span><span class="p">(</span><span class="n">outliers_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="n">how</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span>
                                          <span class="n">max_width</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="p">,</span> <span class="n">get_reformat_filename_func</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_outliers_gallery&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>


    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_outliers_gallery&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.create_components_gallery</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_components_gallery"></a>
  <div class="doc doc-contents first">
  
      <p>Function to create and display a gallery of images for the largest graph components</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>path to fastdup work_dir</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>output folder location for the visuals</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>lazy_load</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>group_by</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>[visual|label]. Group the report using the visual properties of the image or using the labels of the images. Default is visual.</p></td>
          <td>
                <code>&#39;visual&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>slice</code></td>
          <td>
                <code>str or list</code>
          </td>
          <td><p>Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to set the max html width of images in the gallery. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_items</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to limit the number of items displayed (labels for group_by='visual' or components for group_by='label'). Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_bounding_box_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow plotting bounding boxes on top of the image.  The input is an absolute path to the image and the output is a list of bounding boxes.  Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_reformat_filename_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow changing the presented filename into another string.  The input is an absolute path to the image and the output is the string to display instead of the filename.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_extra_col_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow adding more information to the report.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Optional parameter to set the treshold for chosing components. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>metric</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to set the metric to use (like blur) for chose components. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>descending</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>Optional parameter to set the order of the components. Default is True namely list components from largest to smallest.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>min_items</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to select components with min_items or more items. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>keyword</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to select components with keyword asa subset of the label. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to specify the input directory of webdataset tar files,<br />
in case when working with webdataset tar files where the image was deleted after run using turi_param='delete_img=1'</p>
<p>kwargs (dict): Optional parameter to pass additional parameters to the function.<br />
split_sentence_to_label_list (boolean): Optional parameter to split the label into a list of labels. Default is False.<br />
limit_labels_printed (int): Optional parameter to limit the number of labels printed in the html report. Default is max_items.<br />
nrows (int): limit the number of read rows for debugging purposes of the report<br />
save_artifacts (bool): Optional param to save intermediate artifacts like image paths used for generating the component</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, otherwise 1</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_components_gallery</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lazy_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;visual&#39;</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">get_reformat_filename_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Function to create and display a gallery of images for the largest graph components</span>

<span class="sd">    Args:</span>
<span class="sd">        work_dir (str): path to fastdup work_dir</span>

<span class="sd">        save_path (str): output folder location for the visuals</span>

<span class="sd">        num_images (int): Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</span>

<span class="sd">        lazy_load (boolean): If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        group_by (str): [visual|label]. Group the report using the visual properties of the image or using the labels of the images. Default is visual.</span>

<span class="sd">        slice (str or list): Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</span>

<span class="sd">        max_width (int): Optional parameter to set the max html width of images in the gallery. Default is None.</span>

<span class="sd">        max_items (int): Optional parameter to limit the number of items displayed (labels for group_by=&#39;visual&#39; or components for group_by=&#39;label&#39;). Default is None.</span>

<span class="sd">        get_bounding_box_func (callable): Optional parameter to allow plotting bounding boxes on top of the image.  The input is an absolute path to the image and the output is a list of bounding boxes.  Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</span>

<span class="sd">        get_reformat_filename_func (callable): Optional parameter to allow changing the presented filename into another string.  The input is an absolute path to the image and the output is the string to display instead of the filename.</span>

<span class="sd">        get_extra_col_func (callable): Optional parameter to allow adding more information to the report.</span>

<span class="sd">        threshold (float): Optional parameter to set the treshold for chosing components. Default is None.</span>

<span class="sd">        metric (str): Optional parameter to set the metric to use (like blur) for chose components. Default is None.</span>

<span class="sd">        descending (boolean): Optional parameter to set the order of the components. Default is True namely list components from largest to smallest.</span>

<span class="sd">        min_items (int): Optional parameter to select components with min_items or more items. Default is None.</span>

<span class="sd">        keyword (str): Optional parameter to select components with keyword asa subset of the label. Default is None.</span>

<span class="sd">        input_dir (str): Optional parameter to specify the input directory of webdataset tar files,</span>
<span class="sd">            in case when working with webdataset tar files where the image was deleted after run using turi_param=&#39;delete_img=1&#39;</span>

<span class="sd">         kwargs (dict): Optional parameter to pass additional parameters to the function.</span>
<span class="sd">            split_sentence_to_label_list (boolean): Optional parameter to split the label into a list of labels. Default is False.</span>
<span class="sd">            limit_labels_printed (int): Optional parameter to limit the number of labels printed in the html report. Default is max_items.</span>
<span class="sd">            nrows (int): limit the number of read rows for debugging purposes of the report</span>
<span class="sd">            save_artifacts (bool): Optional param to save intermediate artifacts like image paths used for generating the component</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (int): 0 in case of success, otherwise 1</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">check_params</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">if</span> <span class="n">max_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_items</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span> <span class="s2">&quot;max items should be an integer&quot;</span>
            <span class="k">assert</span> <span class="n">max_items</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;html image width should be &gt; 0&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">work_dir</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">input_dir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;input_dir&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="n">input_dir</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;input_dir&#39;</span><span class="p">]</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">do_create_components_gallery</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="n">group_by</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span>
                                            <span class="n">max_width</span><span class="p">,</span> <span class="n">max_items</span><span class="p">,</span> <span class="n">min_items</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="p">,</span>
                                            <span class="n">get_reformat_filename_func</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                                            <span class="n">descending</span><span class="o">=</span><span class="n">descending</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="n">keyword</span><span class="p">,</span> <span class="n">comp_type</span><span class="o">=</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_components_gallery&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_components_gallery&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.create_component_videos_gallery</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_component_videos_gallery"></a>
  <div class="doc doc-contents first">
  
      <p>Function to create and display a gallery of similar videos based on the graph components</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>path to fastdup work_dir</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>output folder location for the visuals</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>lazy_load</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>group_by</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>[visual|label]. Group the report using the visual properties of the image or using the labels of the images. Default is visual.</p></td>
          <td>
                <code>&#39;visual&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>slice</code></td>
          <td>
                <code>str or list</code>
          </td>
          <td><p>Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to set the max html width of images in the gallery. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_items</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to limit the number of items displayed (labels for group_by='visual' or components for group_by='label'). Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_bounding_box_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow plotting bounding boxes on top of the image.  The input is an absolute path to the image and the output is a list of bounding boxes.  Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_reformat_filename_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow changing the presented filename into another string.  The input is an absolute path to the image and the output is the string to display instead of the filename.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_extra_col_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow adding more information to the report.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Optional parameter to set the treshold for chosing components. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>metric</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to set the metric to use (like blur) for chose components. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>descending</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>Optional parameter to set the order of the components. Default is True namely list components from largest to smallest.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>min_items</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to select components with min_items or more items. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>keyword</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to select components with keyword asa subset of the label. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to specify the input directory of webdataset tar files,<br />
in case when working with webdataset tar files where the image was deleted after run using turi_param='delete_img=1'</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, otherwise 1</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_component_videos_gallery</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lazy_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;visual&#39;</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">get_reformat_filename_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Function to create and display a gallery of similar videos based on the graph components</span>

<span class="sd">    Args:</span>
<span class="sd">        work_dir (str): path to fastdup work_dir</span>

<span class="sd">        save_path (str): output folder location for the visuals</span>

<span class="sd">        num_images (int): Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</span>

<span class="sd">        lazy_load (boolean): If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        group_by (str): [visual|label]. Group the report using the visual properties of the image or using the labels of the images. Default is visual.</span>

<span class="sd">        slice (str or list): Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</span>

<span class="sd">        max_width (int): Optional parameter to set the max html width of images in the gallery. Default is None.</span>

<span class="sd">        max_items (int): Optional parameter to limit the number of items displayed (labels for group_by=&#39;visual&#39; or components for group_by=&#39;label&#39;). Default is None.</span>

<span class="sd">        get_bounding_box_func (callable): Optional parameter to allow plotting bounding boxes on top of the image.  The input is an absolute path to the image and the output is a list of bounding boxes.  Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</span>

<span class="sd">        get_reformat_filename_func (callable): Optional parameter to allow changing the presented filename into another string.  The input is an absolute path to the image and the output is the string to display instead of the filename.</span>

<span class="sd">        get_extra_col_func (callable): Optional parameter to allow adding more information to the report.</span>

<span class="sd">        threshold (float): Optional parameter to set the treshold for chosing components. Default is None.</span>

<span class="sd">        metric (str): Optional parameter to set the metric to use (like blur) for chose components. Default is None.</span>

<span class="sd">        descending (boolean): Optional parameter to set the order of the components. Default is True namely list components from largest to smallest.</span>

<span class="sd">        min_items (int): Optional parameter to select components with min_items or more items. Default is None.</span>

<span class="sd">        keyword (str): Optional parameter to select components with keyword asa subset of the label. Default is None.</span>

<span class="sd">        input_dir (str): Optional parameter to specify the input directory of webdataset tar files,</span>
<span class="sd">            in case when working with webdataset tar files where the image was deleted after run using turi_param=&#39;delete_img=1&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (int): 0 in case of success, otherwise 1</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;is_video&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">input_dir</span> <span class="o">=</span> <span class="n">find_similarity_file</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">remove_duplicate_video_distances</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">create_components_gallery</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="o">=</span><span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="o">=</span><span class="n">lazy_load</span><span class="p">,</span>
                                         <span class="n">get_label_func</span><span class="o">=</span><span class="n">get_label_func</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="n">group_by</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">,</span>
                                         <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="n">max_items</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="o">=</span><span class="n">get_bounding_box_func</span><span class="p">,</span>
                                         <span class="n">get_reformat_filename_func</span><span class="o">=</span><span class="n">get_reformat_filename_func</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="o">=</span><span class="n">get_extra_col_func</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                                         <span class="n">descending</span><span class="o">=</span><span class="n">descending</span><span class="p">,</span> <span class="n">min_items</span><span class="o">=</span><span class="n">min_items</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="n">keyword</span><span class="p">,</span> <span class="n">comp_type</span><span class="o">=</span><span class="s2">&quot;component&quot;</span><span class="p">,</span>
                                         <span class="n">input_dir</span><span class="o">=</span><span class="n">input_dir</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_component_video_gallery&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_component_videos_gallery&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.create_kmeans_clusters_gallery</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_kmeans_clusters_gallery"></a>
  <div class="doc doc-contents first">
  
      <p>Function to visualize the kmeans clusters.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>path to fastdup work_dir</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>output folder location for the visuals</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>lazy_load</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>slice</code></td>
          <td>
                <code>str or list</code>
          </td>
          <td><p>Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to set the max html width of images in the gallery. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_items</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to limit the number of items displayed (labels for group_by='visual' or components for group_by='label'). Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_bounding_box_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow plotting bounding boxes on top of the image.  The input is an absolute path to the image and the output is a list of bounding boxes.  Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_reformat_filename_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow changing the presented filename into another string.  The input is an absolute path to the image and the output is the string to display instead of the filename.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_extra_col_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow adding more information to the report.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Optional parameter to set the treshold for chosing components. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>metric</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to set the metric to use (like blur) for chose components. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>descending</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>Optional parameter to set the order of the components. Default is True namely list components from largest to smallest.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>min_items</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional parameter to select components with min_items or more items. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>keyword</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to select components with keyword asa subset of the label. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to specify the input directory of webdataset tar files,<br />
in case when working with webdataset tar files where the image was deleted after run using turi_param='delete_img=1'</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, otherwise 1</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_kmeans_clusters_gallery</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lazy_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">get_reformat_filename_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to visualize the kmeans clusters.</span>

<span class="sd">    Args:</span>

<span class="sd">        work_dir (str): path to fastdup work_dir</span>

<span class="sd">        save_path (str): output folder location for the visuals</span>

<span class="sd">        num_images (int): Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</span>

<span class="sd">        lazy_load (boolean): If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        slice (str or list): Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</span>

<span class="sd">        max_width (int): Optional parameter to set the max html width of images in the gallery. Default is None.</span>

<span class="sd">        max_items (int): Optional parameter to limit the number of items displayed (labels for group_by=&#39;visual&#39; or components for group_by=&#39;label&#39;). Default is None.</span>

<span class="sd">        get_bounding_box_func (callable): Optional parameter to allow plotting bounding boxes on top of the image.  The input is an absolute path to the image and the output is a list of bounding boxes.  Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</span>

<span class="sd">        get_reformat_filename_func (callable): Optional parameter to allow changing the presented filename into another string.  The input is an absolute path to the image and the output is the string to display instead of the filename.</span>

<span class="sd">        get_extra_col_func (callable): Optional parameter to allow adding more information to the report.</span>

<span class="sd">        threshold (float): Optional parameter to set the treshold for chosing components. Default is None.</span>

<span class="sd">        metric (str): Optional parameter to set the metric to use (like blur) for chose components. Default is None.</span>

<span class="sd">        descending (boolean): Optional parameter to set the order of the components. Default is True namely list components from largest to smallest.</span>

<span class="sd">        min_items (int): Optional parameter to select components with min_items or more items. Default is None.</span>

<span class="sd">        keyword (str): Optional parameter to select components with keyword asa subset of the label. Default is None.</span>

<span class="sd">        input_dir (str): Optional parameter to specify the input directory of webdataset tar files,</span>
<span class="sd">            in case when working with webdataset tar files where the image was deleted after run using turi_param=&#39;delete_img=1&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">         ret (int): 0 in case of success, otherwise 1</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">config</span> <span class="o">=</span> <span class="n">load_config</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">work_dir</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">input_dir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;input_dir&#39;</span> <span class="ow">in</span> <span class="n">config</span><span class="p">:</span>
                <span class="n">input_dir</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;input_dir&#39;</span><span class="p">]</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">check_params</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">do_create_components_gallery</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span>
                                            <span class="s1">&#39;visual&#39;</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">max_items</span><span class="p">,</span> <span class="n">min_items</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="p">,</span>
                                            <span class="n">get_reformat_filename_func</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span>
                                            <span class="n">descending</span><span class="o">=</span><span class="n">descending</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="n">keyword</span><span class="p">,</span> <span class="n">comp_type</span><span class="o">=</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span>
                                            <span class="n">input_dir</span><span class="o">=</span><span class="n">input_dir</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_components_gallery&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_kmeans_clusters_gallery&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.create_stats_gallery</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_stats_gallery"></a>
  <div class="doc doc-contents first">
  
      <p>Function to create and display a gallery of images computed by the statistics metrics.<br />
Supported metrics are: mean (color), max (color), min (color), stdv (color), unique (number of unique colors), bluriness (computed by the variance of the laplpacian method<br />
see https://theailearner.com/2021/10/30/blur-detection-using-the-variance-of-the-laplacian-method/.<br />
The metrics are created by fastdup.run() and stored into the <code>work_dir</code> into a file named <code>atrain_stats.csv</code>. Note that the metrics are computed<br />
on the fly fastdup loads and resizes every image only once.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>stats_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>csv file with the computed image statistics by the fastdup tool, alternatively a pandas dataframe. Default stats file is saved by fastdup.run() into the folder <code>work_dir</code> as <code>atrain_stats.csv</code>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>output folder location for the visuals</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>lazy_load</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>metric</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional metric selection. One of 'blur','size','mean','min','max','unique','stdv'.</p></td>
          <td>
                <code>&#39;blur&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>slice</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Option parameter to select the maximal image width in the report</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>descending</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Optional parameter to control the order of the metric</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>get_bounding_box_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow plotting bounding boxes on top of the image. The input is an absolute path to the image and the output is a list of bounding boxes. Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_reformat_filename_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow changing the presented filename into another string.<br />
The input is an absolute path to the image and the output is the string to display instead of the filename.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_extra_col_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow adding extra columns to the gallery.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to specify the input directory of webdataset tar files,<br />
in case when working with webdataset tar files where the image was deleted after run using turi_param='delete_img=1'</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, otherwise 1.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_stats_gallery</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lazy_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                            <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;blur&#39;</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">get_reformat_filename_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to create and display a gallery of images computed by the statistics metrics.</span>
<span class="sd">    Supported metrics are: mean (color), max (color), min (color), stdv (color), unique (number of unique colors), bluriness (computed by the variance of the laplpacian method</span>
<span class="sd">    see https://theailearner.com/2021/10/30/blur-detection-using-the-variance-of-the-laplacian-method/.</span>
<span class="sd">    The metrics are created by fastdup.run() and stored into the `work_dir` into a file named `atrain_stats.csv`. Note that the metrics are computed</span>
<span class="sd">    on the fly fastdup loads and resizes every image only once.</span>

<span class="sd">    Args:</span>
<span class="sd">        stats_file (str): csv file with the computed image statistics by the fastdup tool, alternatively a pandas dataframe. Default stats file is saved by fastdup.run() into the folder `work_dir` as `atrain_stats.csv`.</span>

<span class="sd">        save_path (str): output folder location for the visuals</span>

<span class="sd">        num_images (int): Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</span>

<span class="sd">        lazy_load (boolean): If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        metric (str): Optional metric selection. One of &#39;blur&#39;,&#39;size&#39;,&#39;mean&#39;,&#39;min&#39;,&#39;max&#39;,&#39;unique&#39;,&#39;stdv&#39;.</span>

<span class="sd">        slice (str): Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</span>

<span class="sd">        max_width (int): Option parameter to select the maximal image width in the report</span>

<span class="sd">        descending (bool): Optional parameter to control the order of the metric</span>

<span class="sd">        get_bounding_box_func (callable): Optional parameter to allow plotting bounding boxes on top of the image. The input is an absolute path to the image and the output is a list of bounding boxes. Each bounding box should be 4 integers: x1, y1, x2, y2. Example of valid bounding box list: [[0, 0, 100, 100]]</span>

<span class="sd">        get_reformat_filename_func (callable): Optional parameter to allow changing the presented filename into another string.</span>
<span class="sd">            The input is an absolute path to the image and the output is the string to display instead of the filename.</span>

<span class="sd">        get_extra_col_func (callable): Optional parameter to allow adding extra columns to the gallery.</span>

<span class="sd">        input_dir (str): Optional parameter to specify the input directory of webdataset tar files,</span>
<span class="sd">            in case when working with webdataset tar files where the image was deleted after run using turi_param=&#39;delete_img=1&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (int): 0 in case of success, otherwise 1.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">check_params</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">assert</span> <span class="n">metric</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;blur&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">,</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;unique&#39;</span><span class="p">,</span><span class="s1">&#39;stdv&#39;</span><span class="p">],</span> <span class="s2">&quot;Unknown metric value&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stats_file</span><span class="p">),</span> <span class="s2">&quot;Failed to find outliers file &quot;</span> <span class="o">+</span> <span class="n">stats_file</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">stats_file</span><span class="p">):</span>
                <span class="n">stats_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="s1">&#39;atrain_stats.csv&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">matplotlib</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to import matplotlib. Please install matplotlib using &#39;python3.8 -m pip install matplotlib&#39;&quot;</span><span class="p">)</span>
            <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_stats_gallery&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>


        <span class="n">ret</span> <span class="o">=</span> <span class="n">do_create_stats_gallery</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span>
                                       <span class="n">descending</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="p">,</span> <span class="n">get_reformat_filename_func</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_stats_gallery&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_stats_gallery&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.create_similarity_gallery</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_similarity_gallery"></a>
  <div class="doc doc-contents first">
  
      <p>Function to create and display a gallery of images computed by the similarity metric. In each table row one query image is<br />
displayed and <code>num_images</code> most similar images are displayed next to it on the right.</p>
<p>In case the dataset is labeled, the user can specify the label using the function <code>get_label_func</code>. In this case a <code>score</code> metric is computed to reflect how similar the query image to the most similar images in terms of class label.<br />
Score 100 means that out of the top k num_images similar images, all similar images are from the same class. Score 0 means that the image is similar only to images which are from different class.<br />
Score 50 means that the query image is similar to the same number of images from the same class and from other classes. The report is sorted by the score metric.<br />
For high quality labeled dataset we expect the score to be high, low score may indicate class label issues.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>similarity_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>csv file with the computed image statistics by the fastdup tool, or a path to the work_dir, alternatively a pandas dataframe.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>output folder location for the visuals</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>num_images</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</p></td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>lazy_load</code></td>
          <td>
                <code>boolean</code>
          </td>
          <td><p>If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>slice</code></td>
          <td>
                <code>str or list</code>
          </td>
          <td><p>Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Optional param to limit the image width</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>descending</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Optional param to control the order of the metric</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>get_bounding_box_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow plotting bounding boxes on top of the image.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_reformat_filename_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow changing the presented filename into another string.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_extra_col_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow adding extra columns to the report</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>input_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Optional parameter to specify the input directory of webdataset tar files,<br />
in case when working with webdataset tar files where the image was deleted after run using turi_param='delete_img=1'</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, otherwise 1.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_similarity_gallery</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">lazy_load</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">get_reformat_filename_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>

<span class="sd">    Function to create and display a gallery of images computed by the similarity metric. In each table row one query image is</span>
<span class="sd">    displayed and `num_images` most similar images are displayed next to it on the right.</span>

<span class="sd">    In case the dataset is labeled, the user can specify the label using the function `get_label_func`. In this case a `score` metric is computed to reflect how similar the query image to the most similar images in terms of class label.</span>
<span class="sd">    Score 100 means that out of the top k num_images similar images, all similar images are from the same class. Score 0 means that the image is similar only to images which are from different class.</span>
<span class="sd">    Score 50 means that the query image is similar to the same number of images from the same class and from other classes. The report is sorted by the score metric.</span>
<span class="sd">    For high quality labeled dataset we expect the score to be high, low score may indicate class label issues.</span>

<span class="sd">    Args:</span>
<span class="sd">        similarity_file (str): csv file with the computed image statistics by the fastdup tool, or a path to the work_dir, alternatively a pandas dataframe.</span>

<span class="sd">        save_path (str): output folder location for the visuals</span>

<span class="sd">        num_images (int): Max number of images to display (default = 50). Be careful not to display too many images at once otherwise the notebook may go out of memory.</span>

<span class="sd">        lazy_load (boolean): If False, write all images inside html file using base64 encoding. Otherwise use lazy loading in the html to load images when mouse curser is above the image (reduced html file size).</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        slice (str or list): Optional parameter to select a slice of the outliers file based on a specific label or a list of labels.</span>
<span class="sd">        A special value is &#39;label_score&#39; which is used for comparing both images and labels of the nearest neighbors. The score values are 0-&gt;100 where</span>
<span class="sd">        0 means the query image is only similar to images outside its class, 100 means the query image is only similar to images from the same class.</span>

<span class="sd">        max_width (int): Optional param to limit the image width</span>

<span class="sd">        descending (bool): Optional param to control the order of the metric</span>

<span class="sd">        get_bounding_box_func (callable): Optional parameter to allow plotting bounding boxes on top of the image.</span>

<span class="sd">        get_reformat_filename_func (callable): Optional parameter to allow changing the presented filename into another string.</span>

<span class="sd">        get_extra_col_func (callable): Optional parameter to allow adding extra columns to the report</span>

<span class="sd">        input_dir (str): Optional parameter to specify the input directory of webdataset tar files,</span>
<span class="sd">            in case when working with webdataset tar files where the image was deleted after run using turi_param=&#39;delete_img=1&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (int): 0 in case of success, otherwise 1.</span>

<span class="sd">     &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">check_params</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">),</span> <span class="s2">&quot;Failed to find outliers file &quot;</span> <span class="o">+</span> <span class="n">similarity_file</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">):</span>
                <span class="n">similarity_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">FILENAME_SIMILARITY</span><span class="p">)</span>

        <span class="n">ret</span> <span class="o">=</span> <span class="n">do_create_similarity_gallery</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="n">lazy_load</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span>
            <span class="nb">slice</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">descending</span><span class="p">,</span> <span class="n">get_bounding_box_func</span><span class="p">,</span> <span class="n">get_reformat_filename_func</span><span class="p">,</span> <span class="n">get_extra_col_func</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_similarity_gallery&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_similarity_gallery&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.create_aspect_ratio_gallery</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_aspect_ratio_gallery"></a>
  <div class="doc doc-contents first">
  
      <p>Function to create and display a gallery of aspect ratio distribution.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>stats_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>csv file with the computed image statistics by the fastdup tool, or work_dir path or a pandas dataframe with the stats compouted by fastdup.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>
      <pre><code>get_label_func (callable): optional function given an absolute path to an image return the image label.
    Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.
    Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.

 max_width (int): optional parameter to limit the plot image width

 save_path (str): output folder location for the visuals

 num_images (int): optional number of images to compute the statistics on (default computes on all images)

 slice (str): optional parameter to slice the stats file based on a specific label or a list of labels.

 get_filename_reformat_func (callable): optional function to reformat the filename before displaying it.

input_dir (str): Optional parameter to specify the input directory of webdataset tar files,
    in case when working with webdataset tar files where the image was deleted after run using turi_param='delete_img=1'
</code></pre>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_aspect_ratio_gallery</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_images</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                <span class="n">get_filename_reformat_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">input_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to create and display a gallery of aspect ratio distribution.</span>

<span class="sd">    Args:</span>
<span class="sd">         stats_file (str): csv file with the computed image statistics by the fastdup tool, or work_dir path or a pandas dataframe with the stats compouted by fastdup.</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">         max_width (int): optional parameter to limit the plot image width</span>

<span class="sd">         save_path (str): output folder location for the visuals</span>

<span class="sd">         num_images (int): optional number of images to compute the statistics on (default computes on all images)</span>

<span class="sd">         slice (str): optional parameter to slice the stats file based on a specific label or a list of labels.</span>

<span class="sd">         get_filename_reformat_func (callable): optional function to reformat the filename before displaying it.</span>

<span class="sd">        input_dir (str): Optional parameter to specify the input directory of webdataset tar files,</span>
<span class="sd">            in case when working with webdataset tar files where the image was deleted after run using turi_param=&#39;delete_img=1&#39;</span>

<span class="sd">    Returns:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">check_params</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">max_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stats_file</span><span class="p">),</span> <span class="s2">&quot;Failed to find outliers file &quot;</span> <span class="o">+</span> <span class="n">stats_file</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">stats_file</span><span class="p">):</span>
                <span class="n">stats_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="s1">&#39;atrain_stats.csv&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">matplotlib</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_aspect_ratio_gallery&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to import matplotlib. Please install matplotlib using &#39;python3.8 -m pip install matplotlib&#39;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>


        <span class="n">ret</span> <span class="o">=</span> <span class="n">do_create_aspect_ratio_gallery</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="n">max_width</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">input_dir</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_aspect_ratio_gallery&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_aspect_ratio_gallery&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 id="fastdup-classifiers">Fastdup classifiers</h2>
<p>Given fastdup output compute a baseline lightweight classifier<br />
<code>fastdup.create_knn_classifier</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_knn_classifier"></a>
  <div class="doc doc-contents first">
  
      <p>Function to create a knn classifier out of fastdup run. We assume there are existing labels to the datapoints.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>fastdup work_dir, or location of a similarity file, or a pandas DataFrame with the computed similarities</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>k</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>(unused)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>optional threshold to consider neighbors with similarity larger than threshold<br />
prediction per image to one of the given classes.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>df</code></td>          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>List of predictions using knn method</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_knn_classifier</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to create a knn classifier out of fastdup run. We assume there are existing labels to the datapoints.</span>

<span class="sd">    Args:</span>
<span class="sd">        work_dir (str): fastdup work_dir, or location of a similarity file, or a pandas DataFrame with the computed similarities</span>
<span class="sd">        k (int): (unused)</span>
<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>
<span class="sd">        threshold (float): optional threshold to consider neighbors with similarity larger than threshold</span>
<span class="sd">            prediction per image to one of the given classes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        df (pd.DataFrame): List of predictions using knn method</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">fastdup.confusion_matrix</span> <span class="kn">import</span> <span class="n">classification_report</span>

        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">work_dir</span><span class="p">),</span> <span class="s2">&quot;Failed to find work directory &quot;</span> <span class="o">+</span> <span class="n">work_dir</span>
        <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">)),</span> \
            <span class="s2">&quot;Please provide a valid callable function get_label_func, given a filename returns its string label or a list of labels, &quot;</span> \
            <span class="s2">&quot;or a dictionary where the key is the absolute file name and the value is the label or list of labels or a labels file with header index,label where&quot;</span> \
            <span class="s2">&quot;each row is a label corresponding to the image in the atrain_features_data.csv file&quot;</span>

        <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">threshold</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Please provide a valid threshold 0-&gt;1&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">work_dir</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="s2">&quot;Empty dataframe received&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">work_dir</span><span class="p">):</span>
                <span class="n">similarity_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">FILENAME_SIMILARITY</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">similarity_file</span><span class="p">)</span>

        <span class="n">labels_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">):</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;to_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;to_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_label_func</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MISSING_LABEL</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">labels_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">)</span>
            <span class="n">filenames_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">FILENAME_IMAGE_LIST</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_df</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames_df</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: labels file length does not match the number of images in the similarity file&#39;</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels_df</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s1">&#39;label&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Error: labels file does not contain a label column&#39;</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">filenames_df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels_df</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="n">labels_dict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">filenames_df</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">filenames_df</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;to_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">labels_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MISSING_LABEL</span><span class="p">))</span>

        <span class="n">from_list</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;to&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">distance_list</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;distance&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">to_label_list</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;from&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="s1">&#39;to_label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

        <span class="n">df_from</span> <span class="o">=</span> <span class="n">from_list</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="n">df_dist</span> <span class="o">=</span> <span class="n">distance_list</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
        <span class="n">df_label</span> <span class="o">=</span> <span class="n">to_label_list</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>

        <span class="n">df_merge</span> <span class="o">=</span> <span class="n">df_from</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_dist</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;from&#39;</span><span class="p">)</span>
        <span class="n">df_merge</span> <span class="o">=</span> <span class="n">df_merge</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_label</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;from&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">):</span>
            <span class="n">df_merge</span><span class="p">[</span><span class="s1">&#39;from_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_merge</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">df_merge</span><span class="p">[</span><span class="s1">&#39;from_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_merge</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">get_label_func</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MISSING_LABEL</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">labels_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">df_merge</span><span class="p">[</span><span class="s1">&#39;from_label&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_merge</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">labels_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">MISSING_LABEL</span><span class="p">))</span>


        <span class="n">df_merge</span><span class="p">[</span><span class="s1">&#39;top_k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_merge</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                                           <span class="n">top_k_label</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;to_label&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span> <span class="n">k</span><span class="p">,</span> <span class="n">threshold</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">y_values</span> <span class="o">=</span> <span class="n">df_merge</span><span class="p">[</span><span class="s1">&#39;from_label&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">p1_values</span> <span class="o">=</span> <span class="n">df_merge</span><span class="p">[</span><span class="s1">&#39;top_k&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">filenames</span> <span class="o">=</span> <span class="n">df_merge</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">p1_values</span><span class="p">))</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_knn_classifier&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">filenames</span><span class="p">,</span> <span class="s1">&#39;prediction&#39;</span><span class="p">:</span><span class="n">p1_values</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="n">y_values</span><span class="p">})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_knn_classifier&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;filename&#39;</span><span class="p">:[]})</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.create_kmeans_classifier</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.create_kmeans_classifier"></a>
  <div class="doc doc-contents first">
  
      <p>Function to create a knn classifier out of fastdup run. We assume there are existing labels to the datapoints.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>fastdup work_dir, or location of a similarity file, or a pandas DataFrame with the computed similarities</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>k</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>(unused)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>(unused)</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>df</code></td>          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>dataframe with filename, label and predicted label. Row per each image</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">create_kmeans_classifier</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to create a knn classifier out of fastdup run. We assume there are existing labels to the datapoints.</span>

<span class="sd">    Args:</span>
<span class="sd">        work_dir (str): fastdup work_dir, or location of a similarity file, or a pandas DataFrame with the computed similarities</span>
<span class="sd">        k (int): (unused)</span>
<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>
<span class="sd">        threshold (float): (unused)</span>

<span class="sd">    Returns:</span>
<span class="sd">        df (pd.DataFrame): dataframe with filename, label and predicted label. Row per each image</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">fastdup.confusion_matrix</span> <span class="kn">import</span> <span class="n">classification_report</span>

        <span class="k">assert</span> <span class="n">callable</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">get_label_func</span><span class="p">)),</span> \
            <span class="s2">&quot;Please provide a valid callable function get_label_func, given a filename returns its string label or a list of labels, &quot;</span> \
            <span class="s2">&quot;or a dictionary where the key is the absolute file name and the value is the label or list of labels or a labels file with header index,label where&quot;</span> \
            <span class="s2">&quot;each row is a label corresponding to the image in the atrain_features_data.csv file&quot;</span>

        <span class="n">comps</span> <span class="o">=</span> <span class="n">find_top_components</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="s1">&#39;visual&#39;</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">comp_type</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">comps</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">comps</span><span class="p">[</span><span class="s1">&#39;top_k&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">comps</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                                           <span class="n">top_k_label</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">],</span> <span class="n">k</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">p1_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">comps</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">cluster_label</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;top_k&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">f</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]):</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">y_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
                <span class="n">p1_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cluster_label</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">y_values</span><span class="p">,</span> <span class="n">p1_values</span><span class="p">))</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;create_kmeans_classifier&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;prediction&#39;</span><span class="p">:</span><span class="n">p1_values</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="n">y_values</span><span class="p">,</span> <span class="s1">&#39;filename&#39;</span><span class="p">:</span><span class="n">files</span><span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;create_kmeans_classifier&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;filename&#39;</span><span class="p">:[]})</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 id="fastdup-utilities">Fastdup utilities</h2>
<p>Loading the binary feature resulting in fastdup run can be done by <code>fastdup.load_binary_features</code>.</p>
<p><code>fastdup.load_binary_feature</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.load_binary_feature"></a>
  <div class="doc doc-contents first">
  
      <p>Python function for loading the stored binary features written by fastdup and their matching filenames and analyzing them in Python.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>The binary feature file location</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>d</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Feature vector length</p></td>
          <td>
                <code>576</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>filenames</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>A list of with all image file names of length X.</p></td>
        </tr>
        <tr>
<td><code>np_array</code></td>          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td><p>An np matrix of shape rows x d cols (default d is 576). Each row conform to feature vector os a single image.</p></td>
        </tr>
    </tbody>
  </table>

<details class="example">
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import fastdup<br />
file_list, mat_features = fastdup.load_binary(FILENAME_FEATURES)</p>
</blockquote>
</blockquote>
</blockquote>
</details>
      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">load_binary_feature</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">576</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Python function for loading the stored binary features written by fastdup and their matching filenames and analyzing them in Python.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The binary feature file location</span>
<span class="sd">        d (int): Feature vector length</span>

<span class="sd">    Returns:</span>
<span class="sd">        filenames (list): A list of with all image file names of length X.</span>
<span class="sd">        np_array (np.array): An np matrix of shape rows x d cols (default d is 576). Each row conform to feature vector os a single image.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import fastdup</span>
<span class="sd">        &gt;&gt;&gt; file_list, mat_features = fastdup.load_binary(FILENAME_FEATURES)</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error: failed to find the binary feature file:&quot;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39; and the filenames csv file:&#39;</span><span class="p">,</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">d</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;Feature vector length d has to be larger than zero&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;&lt;f&#39;</span><span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">)[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">assert</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Failed to read input file &quot;</span> <span class="o">+</span> <span class="n">filename</span>
    <span class="n">num_images</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">);</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Read a total of &#39;</span><span class="p">,</span> <span class="n">num_images</span><span class="p">,</span> <span class="s1">&#39;images&#39;</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">num_images</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span>
    <span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">d</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.save_binary_feature</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.save_binary_feature"></a>
  <div class="doc doc-contents first">
  
      <p>Function for saving data to be used by fastdup. Given a list of images and their matching feature vectors in a numpy array,<br />
function saves data in a format readable by fastdup. This saves the image extraction step, to be used with run_mode=1 namely perform<br />
nearest neighbor model on the feature vectors.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Working folder to save the files to</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>filenames</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>A list of file location of the images (absolute paths) of length n images</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>np_array</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.array">array</span></code>
          </td>
          <td><p>Numpy array of size n x d. Each row is a feature vector of one file.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, otherwise 1</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_binary_feature</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">filenames</span><span class="p">,</span> <span class="n">np_array</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function for saving data to be used by fastdup. Given a list of images and their matching feature vectors in a numpy array,</span>
<span class="sd">    function saves data in a format readable by fastdup. This saves the image extraction step, to be used with run_mode=1 namely perform</span>
<span class="sd">    nearest neighbor model on the feature vectors.</span>

<span class="sd">    Args:</span>
<span class="sd">        save_path (str): Working folder to save the files to</span>
<span class="sd">        filenames (list): A list of file location of the images (absolute paths) of length n images</span>
<span class="sd">        np_array (np.array): Numpy array of size n x d. Each row is a feature vector of one file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (int): 0 in case of success, otherwise 1</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>  <span class="ow">and</span> <span class="n">save_path</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Save path should be a non empty string&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">&quot;filenames should be a list of image files&quot;</span>
    <span class="k">assert</span> <span class="n">filenames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">),</span> <span class="s2">&quot;filenames should be a non empty list&quot;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filenames</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">),</span> <span class="s1">&#39;filenames should contain strings with the image absolute paths&#39;</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">np_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">),</span>  <span class="s2">&quot;np_array should be a numpy array&quot;</span>
    <span class="k">assert</span> <span class="n">np_array</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="s1">&#39;float32&#39;</span><span class="p">,</span> <span class="s2">&quot;np_array dtype must be float32. You can generate the array using the&quot;</span> \
                              <span class="s2">&quot;command: features = np.zeros((rows, cols), dtype=&#39;float32&#39;)&quot;</span>
    <span class="k">assert</span> <span class="n">np_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames</span><span class="p">),</span> <span class="s2">&quot;np_array should contain rows matching to the filenames list&quot;</span>


    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_path</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;filename&#39;</span><span class="p">:</span> <span class="n">filenames</span><span class="p">})</span>
        <span class="n">local_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="s1">&#39;atrain_features.dat&#39;</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">local_filename</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">bytes_array</span> <span class="o">=</span> <span class="n">np_array</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">bytes_array</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_filename</span><span class="p">),</span> <span class="s2">&quot;Failed to save file &quot;</span> <span class="o">+</span> <span class="n">local_filename</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to save to &quot;</span> <span class="o">+</span> <span class="n">save_path</span> <span class="o">+</span> <span class="s2">&quot; Exception: &quot;</span> <span class="o">+</span> <span class="n">ex</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.generate_sprite_image</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.generate_sprite_image"></a>
  <div class="doc doc-contents first">
  
      <p>Generate a sprite image of images for tensorboard projector. A sprite image is a large image composed of grid of smaller images.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>img_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>list of image filenames (full path)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sample_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>how many images in to plot</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>log_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>directory to save the sprite image</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>h</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>optional requested hight of each subimage</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>w</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>optional requested width of each subimage</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>alternative_filename</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional parameter to save the resulting image to a different name</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>alternative_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>optional parameter to control the number of images per row</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_width</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>optional parameter to control the rsulting width of the image</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>path</code></td>          <td>
                <code>str</code>
          </td>
          <td><p>path to sprite image</p></td>
        </tr>
        <tr>
<td><code>labels</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>list of labels</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_sprite_image</span><span class="p">(</span><span class="n">img_list</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alternative_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alternative_width</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate a sprite image of images for tensorboard projector. A sprite image is a large image composed of grid of smaller images.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        img_list (list): list of image filenames (full path)</span>

<span class="sd">        sample_size (int):  how many images in to plot</span>

<span class="sd">        log_dir (str): directory to save the sprite image</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        h (int): optional requested hight of each subimage</span>

<span class="sd">        w (int): optional requested width of each subimage</span>

<span class="sd">        alternative_filename (str): optional parameter to save the resulting image to a different name</span>

<span class="sd">        alternative_width (int): optional parameter to control the number of images per row</span>

<span class="sd">        max_width (int): optional parameter to control the rsulting width of the image</span>

<span class="sd">    Returns:</span>
<span class="sd">        path (str): path to sprite image</span>
<span class="sd">        labels (list): list of labels</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">img_list</span><span class="p">),</span> <span class="s2">&quot;Image list is empty&quot;</span>
        <span class="k">assert</span> <span class="n">sample_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="kn">from</span> <span class="nn">fastdup.tensorboard_projector</span> <span class="kn">import</span> <span class="n">generate_sprite_image</span> <span class="k">as</span> <span class="n">tgenerate_sprite_image</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">tgenerate_sprite_image</span><span class="p">(</span><span class="n">img_list</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                                      <span class="n">alternative_filename</span><span class="o">=</span><span class="n">alternative_filename</span><span class="p">,</span> <span class="n">alternative_width</span><span class="o">=</span><span class="n">alternative_width</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="n">max_width</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;generate_sprite_image&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.export_to_tensorboard_projector</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.export_to_tensorboard_projector"></a>
  <div class="doc doc-contents first">
  
      <p>Export feature vector embeddings to be visualized using tensorboard projector app.</p>

<details class="example">
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import fastdup<br />
fastdup.run('/my/data/', work_dir='out')<br />
fastdup.export_to_tensorboard_projector(work_dir='out', log_dir='logs')</p>
</blockquote>
</blockquote>
</blockquote>
<p>After data is exporeted run tensorboard projector</p>
<blockquote>
<blockquote>
<blockquote>
<p>%load_ext tensorboard<br />
%tensorboard --logdir=logs</p>
</blockquote>
</blockquote>
</blockquote>
</details>
  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>work_dir where fastdup results are stored</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>log_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>output dir where tensorboard will read from</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sample_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>how many images to view. Default is 900.</p></td>
          <td>
                <code>900</code>
          </td>
        </tr>
        <tr>
          <td><code>sample_method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>how to sample, currently 'random' is supported.</p></td>
          <td>
                <code>&#39;random&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>with_images</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>add images to the visualization (default True)</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>d</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>dimension of the embedding vector. Default is 576.</p></td>
          <td>
                <code>576</code>
          </td>
        </tr>
        <tr>
          <td><code>file_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>Optional parameter to specify a list of files to be used for the visualization. If not specified, filenames are taken from the work_dir/atrain_features.dat.csv file<br />
          Note: be careful here as the order of the file_list matters, need to keep the exact same order as the atrain_features.dat.csv file!</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, 1 in case of failure</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">export_to_tensorboard_projector</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">sample_size</span> <span class="o">=</span> <span class="mi">900</span><span class="p">,</span>
                                    <span class="n">sample_method</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">with_images</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="mi">576</span><span class="p">,</span> <span class="n">file_list</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Export feature vector embeddings to be visualized using tensorboard projector app.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import fastdup</span>
<span class="sd">        &gt;&gt;&gt; fastdup.run(&#39;/my/data/&#39;, work_dir=&#39;out&#39;)</span>
<span class="sd">        &gt;&gt;&gt; fastdup.export_to_tensorboard_projector(work_dir=&#39;out&#39;, log_dir=&#39;logs&#39;)</span>

<span class="sd">        After data is exporeted run tensorboard projector</span>
<span class="sd">        &gt;&gt;&gt; %load_ext tensorboard</span>
<span class="sd">        &gt;&gt;&gt; %tensorboard --logdir=logs</span>

<span class="sd">    Args:</span>
<span class="sd">        work_dir (str): work_dir where fastdup results are stored</span>

<span class="sd">        log_dir (str): output dir where tensorboard will read from</span>

<span class="sd">        sample_size (int): how many images to view. Default is 900.</span>

<span class="sd">        sample_method (str): how to sample, currently &#39;random&#39; is supported.</span>

<span class="sd">        with_images (bool): add images to the visualization (default True)</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        d (int): dimension of the embedding vector. Default is 576.</span>

<span class="sd">        file_list (list): Optional parameter to specify a list of files to be used for the visualization. If not specified, filenames are taken from the work_dir/atrain_features.dat.csv file</span>
<span class="sd">                      Note: be careful here as the order of the file_list matters, need to keep the exact same order as the atrain_features.dat.csv file!</span>
<span class="sd">    Returns:</span>
<span class="sd">        ret (int): 0 in case of success, 1 in case of failure</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">tensorflow</span>
            <span class="kn">from</span> <span class="nn">tensorboard.plugins</span> <span class="kn">import</span> <span class="n">projector</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;For saving information for tensorboard project you need to install tensorflow. Please pip install tensorflow and tensorbaord and try again&#39;</span><span class="p">)</span>
            <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;tensorflow import&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>


        <span class="kn">from</span> <span class="nn">fastdup.tensorboard_projector</span> <span class="kn">import</span> <span class="n">export_to_tensorboard_projector_inner</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">work_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">work_dir</span><span class="p">),</span> <span class="s1">&#39;Failed to create work_dir &#39;</span> <span class="o">+</span> <span class="n">work_dir</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="s1">&#39;atrain_features.dat&#39;</span><span class="p">)),</span> <span class="sa">f</span><span class="s1">&#39;Faild to find fastdup output </span><span class="si">{</span><span class="n">work_dir</span><span class="si">}</span><span class="s1">atrain_features.dat&#39;</span>
        <span class="k">assert</span> <span class="n">sample_size</span> <span class="o">&lt;=</span> <span class="mi">5000</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Tensorboard projector is limited by 5000 images&#39;</span>

        <span class="n">imglist</span><span class="p">,</span> <span class="n">features</span> <span class="o">=</span> <span class="n">load_binary_feature</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="s1">&#39;atrain_features.dat&#39;</span><span class="p">),</span> <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">file_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">file_list</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s1">&#39;file_list should be a list of absolute file names given in the same order&#39;</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">imglist</span><span class="p">),</span> <span class="s2">&quot;file_list should be the same length as imglist got &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">file_list</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; and &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">imglist</span><span class="p">))</span>
        <span class="n">export_to_tensorboard_projector_inner</span><span class="p">(</span><span class="n">imglist</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">sample_method</span><span class="p">,</span> <span class="n">with_images</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;export_to_tensorboard_projector&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;export_to_tensorboard_projector&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.export_to_cvat</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.export_to_cvat"></a>
  <div class="doc doc-contents first">
  
      <p>Function to export a collection of files that needs to be annotated again to cvat batch job format.<br />
This creates a file named fastdup_label.zip in the directory save_path.<br />
The files can be retagged in cvat using Tasks -&gt; Add (plus button) -&gt; Create from backup -&gt; choose the location of the fastdup_label.zip file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>files</code></td>
          <td>
                <code>str</code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>labels</code></td>
          <td>
                <code>str</code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, otherwise 1.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">export_to_cvat</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">save_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to export a collection of files that needs to be annotated again to cvat batch job format.</span>
<span class="sd">    This creates a file named fastdup_label.zip in the directory save_path.</span>
<span class="sd">    The files can be retagged in cvat using Tasks -&gt; Add (plus button) -&gt; Create from backup -&gt; choose the location of the fastdup_label.zip file.</span>

<span class="sd">    Args:</span>
<span class="sd">        files (str):</span>
<span class="sd">        labels (str):</span>
<span class="sd">        save_path (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (int): 0 in case of success, otherwise 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="s2">&quot;Please provide a list of files&quot;</span>
        <span class="k">assert</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">&quot;Please provide a list of labels&quot;</span>

        <span class="kn">from</span> <span class="nn">fastdup.cvat</span> <span class="kn">import</span> <span class="n">do_export_to_cvat</span>
        <span class="n">ret</span> <span class="o">=</span>  <span class="n">do_export_to_cvat</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;export_to_cvat&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;export_to_cvat&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.export_to_labelImg</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.export_to_labelImg"></a>
  <div class="doc doc-contents first">
  
      <p>Function to export a collection of files that needs to be annotated again to cvat batch job format.<br />
This creates a file named fastdup_label.zip in the directory save_path.<br />
The files can be retagged in cvat using Tasks -&gt; Add (plus button) -&gt; Create from backup -&gt; choose the location of the fastdup_label.zip file.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>files</code></td>
          <td>
                <code>str</code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>labels</code></td>
          <td>
                <code>str</code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>int</code>
          </td>
          <td><p>0 in case of success, otherwise 1.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">export_to_labelImg</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">save_path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to export a collection of files that needs to be annotated again to cvat batch job format.</span>
<span class="sd">    This creates a file named fastdup_label.zip in the directory save_path.</span>
<span class="sd">    The files can be retagged in cvat using Tasks -&gt; Add (plus button) -&gt; Create from backup -&gt; choose the location of the fastdup_label.zip file.</span>

<span class="sd">    Args:</span>
<span class="sd">        files (str):</span>
<span class="sd">        labels (str):</span>
<span class="sd">        save_path (str):</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (int): 0 in case of success, otherwise 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">),</span> <span class="s2">&quot;Please provide a list of files&quot;</span>
        <span class="k">assert</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">&quot;Please provide a list of labels&quot;</span>

        <span class="kn">from</span> <span class="nn">fastdup.label_img</span> <span class="kn">import</span> <span class="n">do_export_to_labelimg</span>
        <span class="n">ret</span> <span class="o">=</span>  <span class="n">do_export_to_labelimg</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;export_to_labelImg&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;export_to_labelImg&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><h2 id="fastdup-utilities-to-remove-images">Fastdup utilities to remove images</h2>
<p><code>fastdup.find_top_components</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.find_top_components"></a>
  <div class="doc doc-contents first">
  
      <p>Function to find the largest components of duplicate images</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>work_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>working directory where fastdup.run was run.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>get_label_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>optional function given an absolute path to an image return the image label.<br />
Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.<br />
Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>group_by</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional parameter to group by 'visual' or 'label'. When grouping by visual fastdup aggregates visually similar images together.<br />
When grouping by 'label' fastdup aggregates images with the same label together.</p></td>
          <td>
                <code>&#39;visual&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>slice</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional parameter to slice the results by a specific label. For example, if you want to slice by 'car' then pass 'car' as the slice parameter.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>optional threshold to select only distances larger than the treshold</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>metric</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional metric to sort by. Valid values are mean,min,max,unique,blur,size</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>descending</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>optional value to sort the components, default is True</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>min_items</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>optional value, select only components with at least min_items</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>keyword</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional, select labels with keyword  value inside</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>return_stats</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>optional, return statistics about the components size</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional, save path</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>comp_type</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional, either component or cluster</p></td>
          <td>
                <code>&#39;component&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>df</code></td>          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>of top components. The column component_id includes the component name.<br />
The column files includes a list of all image files in this component.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_top_components</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">get_label_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">group_by</span><span class="o">=</span><span class="s1">&#39;visual&#39;</span><span class="p">,</span> <span class="nb">slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">descending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_items</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_items</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">keyword</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">comp_type</span><span class="o">=</span><span class="s2">&quot;component&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to find the largest components of duplicate images</span>

<span class="sd">    Args:</span>
<span class="sd">        work_dir (str): working directory where fastdup.run was run.</span>

<span class="sd">        get_label_func (callable): optional function given an absolute path to an image return the image label.</span>
<span class="sd">            Image label can be a string or a list of strings. Alternatively, get_label_func can be a dictionary where the key is the absolute file name and the value is the label or list of labels.</span>
<span class="sd">            Alternatively, get_label_func can be a filename containing string label for each file. First row should be index,label. Label file should be same length and same order of the atrain_features_data.csv image list file.</span>

<span class="sd">        group_by (str): optional parameter to group by &#39;visual&#39; or &#39;label&#39;. When grouping by visual fastdup aggregates visually similar images together.</span>
<span class="sd">            When grouping by &#39;label&#39; fastdup aggregates images with the same label together.</span>

<span class="sd">        slice (str): optional parameter to slice the results by a specific label. For example, if you want to slice by &#39;car&#39; then pass &#39;car&#39; as the slice parameter.</span>

<span class="sd">        threshold (float): optional threshold to select only distances larger than the treshold</span>

<span class="sd">        metric (str): optional metric to sort by. Valid values are mean,min,max,unique,blur,size</span>

<span class="sd">        descending (bool): optional value to sort the components, default is True</span>

<span class="sd">        min_items (int): optional value, select only components with at least min_items</span>

<span class="sd">        max_items (int) optional value, select only components with at most max_items</span>

<span class="sd">        keyword (str): optional, select labels with keyword  value inside</span>

<span class="sd">        return_stats (bool): optional, return statistics about the components size</span>

<span class="sd">        save_path (str): optional, save path</span>

<span class="sd">        comp_type (str): optional, either component or cluster</span>

<span class="sd">    Returns:</span>
<span class="sd">        df (pd.DataFrame): of top components. The column component_id includes the component name.</span>
<span class="sd">            The column files includes a list of all image files in this component.</span>


<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="kn">from</span> <span class="nn">.galleries</span> <span class="kn">import</span> <span class="n">do_find_top_components</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">do_find_top_components</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="n">get_label_func</span><span class="p">,</span> <span class="n">group_by</span><span class="p">,</span> <span class="nb">slice</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span><span class="p">,</span>
                                      <span class="n">metric</span><span class="o">=</span><span class="n">metric</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="n">descending</span><span class="p">,</span> <span class="n">min_items</span><span class="o">=</span><span class="n">min_items</span><span class="p">,</span> <span class="n">max_items</span> <span class="o">=</span> <span class="n">max_items</span><span class="p">,</span>
                                      <span class="n">keyword</span><span class="o">=</span><span class="n">keyword</span><span class="p">,</span> <span class="n">return_stats</span><span class="o">=</span><span class="n">return_stats</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span> <span class="n">comp_type</span><span class="o">=</span><span class="n">comp_type</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;find_top_components&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;find_top_components&quot;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.delete_components</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.delete_components"></a>
  <div class="doc doc-contents first">
  
      <p>function to automate deletion of duplicate images using the connected components analysis.</p>
<pre><code>Example:
&gt;&gt;&gt; import fastdup
&gt;&gt;&gt; fastdup.run('/path/to/data', '/path/to/output')
&gt;&gt;&gt; top_components = fastdup.find_top_components('/path/to/output')
&gt;&gt;&gt; delete_components(top_components, None, how = 'one', dry_run = False)
</code></pre>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>top_components</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>largest components as found by the function find_top_components().</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>to_delete</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>a list of integer component ids to delete. On default None which means delete duplicates from all components.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>how</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>either 'all' (deletes all the component) or 'one' (leaves one image and delete the rest of the duplicates)</p></td>
          <td>
                <code>&#39;one&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>dry_run</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True does not delete but print the rm commands used, otherwise deletes</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>list of deleted files</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_components</span><span class="p">(</span><span class="n">top_components</span><span class="p">,</span> <span class="n">to_delete</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;one&#39;</span><span class="p">,</span> <span class="n">dry_run</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    function to automate deletion of duplicate images using the connected components analysis.</span>

<span class="sd">        Example:</span>
<span class="sd">        &gt;&gt;&gt; import fastdup</span>
<span class="sd">        &gt;&gt;&gt; fastdup.run(&#39;/path/to/data&#39;, &#39;/path/to/output&#39;)</span>
<span class="sd">        &gt;&gt;&gt; top_components = fastdup.find_top_components(&#39;/path/to/output&#39;)</span>
<span class="sd">        &gt;&gt;&gt; delete_components(top_components, None, how = &#39;one&#39;, dry_run = False)</span>

<span class="sd">    Args:</span>
<span class="sd">        top_components (pd.DataFrame): largest components as found by the function find_top_components().</span>
<span class="sd">        to_delete (list): a list of integer component ids to delete. On default None which means delete duplicates from all components.</span>
<span class="sd">        how (int): either &#39;all&#39; (deletes all the component) or &#39;one&#39; (leaves one image and delete the rest of the duplicates)</span>
<span class="sd">        dry_run (bool): if True does not delete but print the rm commands used, otherwise deletes</span>

<span class="sd">    Returns:</span>
<span class="sd">        ret (list): list of deleted files</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">top_components</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">),</span> <span class="s2">&quot;top_components should be a pandas dataframe&quot;</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_components</span><span class="p">),</span> <span class="s2">&quot;top_components should not be enpty&quot;</span>
        <span class="k">assert</span> <span class="n">to_delete</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_delete</span><span class="p">,</span> <span class="nb">list</span><span class="p">),</span> <span class="s2">&quot;to_delete should be a list of integer component ids&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_delete</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">to_delete</span><span class="p">),</span> <span class="s2">&quot;to_delete should not be empty&quot;</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_delete</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_delete</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="s2">&quot;to_delete should be a list of integer component ids&quot;</span>
        <span class="k">assert</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;one&#39;</span> <span class="ow">or</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s2">&quot;how should be one of &#39;one&#39;|&#39;all&#39;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dry_run</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">to_delete</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">to_delete</span> <span class="o">=</span> <span class="n">top_components</span><span class="p">[</span><span class="s1">&#39;component_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="n">total_deleted</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="p">(</span><span class="n">to_delete</span><span class="p">):</span>
            <span class="n">subdf</span> <span class="o">=</span> <span class="n">top_components</span><span class="p">[</span><span class="n">top_components</span><span class="p">[</span><span class="s1">&#39;component_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">comp</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subdf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: failed to find image files for component id&quot;</span><span class="p">,</span> <span class="n">comp</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">files</span> <span class="o">=</span> <span class="n">subdf</span><span class="p">[</span><span class="s1">&#39;files&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: component id &#39;</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="s1">&#39; has no related images, please check..&#39;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;one&#39;</span><span class="p">):</span>
                <span class="n">files</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

            <span class="n">inner_delete</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span><span class="p">)</span>
            <span class="n">total_deleted</span> <span class="o">+=</span> <span class="n">files</span>

        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;delete_components&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">total_deleted</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;delete_components&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div><p><code>fastdup.delete_or_retag_stats_outliers</code><br />
</p>


<div class="doc doc-object doc-function">


<a id="fastdup.delete_or_retag_stats_outliers"></a>
  <div class="doc doc-contents first">
  
      <p>function to automate deletion of outlier files based on computed statistics.</p>

<details class="example">
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>import fastdup<br />
fastdup.run('/my/data/", work_dir="out")<br />
delete 5% of the brightest images and delete 2% of the darkest images<br />
fastdup.delete_or_retag_stats_outliers("out", metric="mean", lower_percentile=0.05, dry_run=False)</p>
</blockquote>
</blockquote>
</blockquote>
<p>It is recommended to run with dry_run=True first, to see the list of files deleted before actually deleting.</p>
</details>
<details class="example">
  <summary>Example</summary>
  <p>This example first find wrong labels using similarity gallery and then deletes anything with score &lt; 51.<br />
Score is in range 0-100 where 100 means this image is similar only to images from the same class label.<br />
Score 0 means this image is only similar to images from other class labels.</p>
<blockquote>
<blockquote>
<blockquote>
<p>import fastdup<br />
df2 = create_similarity_gallery(..., get_label_func=...)<br />
fastdup.delete_or_retag_stats_outliers(df2, metric='score', filename_col = 'from', lower_threshold=51, dry_run=True)</p>
</blockquote>
</blockquote>
</blockquote>
</details>      <p>Note: it is possible to run with both <code>lower_percentile</code> and <code>upper_percentile</code> at once. It is not possible to run with <code>lower_percentile</code> and <code>lower_threshold</code> at once since they may be conflicting.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>stats_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td><ul>
<li>folder pointing to fastdup workdir or</li>
<li>file pointing to work_dir/atrain_stats.csv file or</li>
<li>pandas DataFrame containing list of files giveb in the filename_col column and a metric column.</li>
</ul></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>metric</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>statistic metric, should be one of "blur", "mean", "min", "max", "stdv", "unique", "width", "height", "size"</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>filename_col</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>column name in the stats_file to use as the filename</p></td>
          <td>
                <code>&#39;filename&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>lower_percentile</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>lower percentile to use for the threshold. Values are 0-&gt;1, where 0.05 means remove 5% of the lowest values.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>upper_percentile</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>upper percentile to use for the threshold. Values are 0-&gt;1, where 0.95 means remove 5% of the upper values.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>lower_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>lower threshold to use for the threshold. Only used if lower_percentile is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>upper_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>upper threshold to use for the threshold. Only used if upper_percentile is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>get_reformat_filename_func</code></td>
          <td>
                <code>callable</code>
          </td>
          <td><p>Optional parameter to allow changing the  filename into another string. Useful in the case fastdup was run on a different folder or machine and you would like to delete files in another folder.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>dry_run</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>if True does not delete but print the rm commands used, otherwise deletes</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>how</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>either 'delete' or 'move' or 'retag'. In case of retag allowed value is retag=labelImg or retag=cvat</p></td>
          <td>
                <code>&#39;delete&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>save_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>optional. In case of a folder and how == 'retag' the label files will be moved to this folder.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>ret</code></td>          <td>
                <code>list</code>
          </td>
          <td><p>list of deleted files (or moved or retagged files)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>fastdup/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete_or_retag_stats_outliers</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">filename_col</span> <span class="o">=</span> <span class="s1">&#39;filename&#39;</span><span class="p">,</span> <span class="n">label_col</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lower_percentile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper_percentile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">lower_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">get_reformat_filename_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">how</span><span class="o">=</span><span class="s1">&#39;delete&#39;</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      function to automate deletion of outlier files based on computed statistics.</span>

<span class="sd">      Example:</span>
<span class="sd">          &gt;&gt;&gt; import fastdup</span>
<span class="sd">          &gt;&gt;&gt; fastdup.run(&#39;/my/data/&quot;, work_dir=&quot;out&quot;)</span>
<span class="sd">          delete 5% of the brightest images and delete 2% of the darkest images</span>
<span class="sd">          &gt;&gt;&gt; fastdup.delete_or_retag_stats_outliers(&quot;out&quot;, metric=&quot;mean&quot;, lower_percentile=0.05, dry_run=False)</span>

<span class="sd">          It is recommended to run with dry_run=True first, to see the list of files deleted before actually deleting.</span>

<span class="sd">      Example:</span>
<span class="sd">          This example first find wrong labels using similarity gallery and then deletes anything with score &lt; 51.</span>
<span class="sd">          Score is in range 0-100 where 100 means this image is similar only to images from the same class label.</span>
<span class="sd">          Score 0 means this image is only similar to images from other class labels.</span>
<span class="sd">          &gt;&gt;&gt; import fastdup</span>
<span class="sd">          &gt;&gt;&gt; df2 = create_similarity_gallery(..., get_label_func=...)</span>
<span class="sd">          &gt;&gt;&gt;fastdup.delete_or_retag_stats_outliers(df2, metric=&#39;score&#39;, filename_col = &#39;from&#39;, lower_threshold=51, dry_run=True)</span>

<span class="sd">      Note: it is possible to run with both `lower_percentile` and `upper_percentile` at once. It is not possible to run with `lower_percentile` and `lower_threshold` at once since they may be conflicting.</span>

<span class="sd">      Args:</span>
<span class="sd">          stats_file (str):</span>
<span class="sd">              * folder pointing to fastdup workdir or</span>
<span class="sd">              * file pointing to work_dir/atrain_stats.csv file or</span>
<span class="sd">              * pandas DataFrame containing list of files giveb in the filename_col column and a metric column.</span>

<span class="sd">          metric (str): statistic metric, should be one of &quot;blur&quot;, &quot;mean&quot;, &quot;min&quot;, &quot;max&quot;, &quot;stdv&quot;, &quot;unique&quot;, &quot;width&quot;, &quot;height&quot;, &quot;size&quot;</span>

<span class="sd">          filename_col (str): column name in the stats_file to use as the filename</span>

<span class="sd">          lower_percentile (float): lower percentile to use for the threshold. Values are 0-&gt;1, where 0.05 means remove 5% of the lowest values.</span>

<span class="sd">          upper_percentile (float): upper percentile to use for the threshold. Values are 0-&gt;1, where 0.95 means remove 5% of the upper values.</span>

<span class="sd">          lower_threshold (float): lower threshold to use for the threshold. Only used if lower_percentile is None.</span>

<span class="sd">          upper_threshold (float): upper threshold to use for the threshold. Only used if upper_percentile is None.</span>

<span class="sd">          get_reformat_filename_func (callable): Optional parameter to allow changing the  filename into another string. Useful in the case fastdup was run on a different folder or machine and you would like to delete files in another folder.</span>

<span class="sd">          dry_run (bool): if True does not delete but print the rm commands used, otherwise deletes</span>

<span class="sd">          how (str): either &#39;delete&#39; or &#39;move&#39; or &#39;retag&#39;. In case of retag allowed value is retag=labelImg or retag=cvat</span>

<span class="sd">          save_path (str): optional. In case of a folder and how == &#39;retag&#39; the label files will be moved to this folder.</span>




<span class="sd">      Returns:</span>
<span class="sd">          ret (list): list of deleted files (or moved or retagged files)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dry_run</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="ow">or</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;move&#39;</span> <span class="ow">or</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;retag&#39;</span><span class="p">,</span> <span class="s2">&quot;how should be one of &#39;delete&#39;|&#39;move&#39;|&#39;retag&#39;&quot;</span>

        <span class="k">if</span> <span class="n">lower_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">lower_percentile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You should only specify one of lower_threshold or lower_percentile&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">upper_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">upper_percentile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You should only specify one of upper_threshold or upper_percentile&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>

            <span class="n">df</span> <span class="o">=</span> <span class="n">stats_file</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="s2">&quot;Empty dataframe&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">stats_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">stats_file</span><span class="p">)):</span>
                <span class="n">stats_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">stats_file</span><span class="p">,</span> <span class="s1">&#39;atrain_stats.csv&#39;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">stats_file</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span> <span class="s2">&quot;Failed to find any data in &quot;</span> <span class="o">+</span> <span class="n">stats_file</span>

        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;score&quot;</span> <span class="ow">and</span> <span class="n">metric</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;For removing wrong labels created by the create_similarity_gallery() need to run stats_file=df where&quot;</span>
                  <span class="s2">&quot;df is the output of create_similarity_gallery()&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">1</span>

        <span class="k">assert</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="n">metric</span><span class="o">==</span><span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unknown metric </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> options are </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">assert</span> <span class="n">filename_col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
        <span class="k">if</span> <span class="n">label_col</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">label_col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label_col</span><span class="si">}</span><span class="s2"> column should be in the stats_file&quot;</span>

        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;size&#39;</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;width&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;height&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lower_percentile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">lower_percentile</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lower_percentile</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;lower_percentile should be between 0 and 1&quot;</span>
            <span class="n">lower_threshold</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">lower_percentile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">upper_percentile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">upper_percentile</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">upper_percentile</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;upper_percentile should be between 0 and 1&quot;</span>
            <span class="n">upper_threshold</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">upper_percentile</span><span class="p">)</span>

        <span class="n">orig_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">orig_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">lower_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Going to delete any images with </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">lower_threshold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">orig_df</span><span class="p">[</span><span class="n">orig_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lower_threshold</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">upper_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Going to delete any images with </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="n">upper_threshold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">orig_df</span><span class="p">[</span><span class="n">orig_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_threshold</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">upper_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Going to delete any images with </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> &gt; </span><span class="si">{</span><span class="n">upper_threshold</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">orig_df</span><span class="p">[</span><span class="n">orig_df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_threshold</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span> <span class="s2">&quot;You should specify either lower_threshold or upper_threshold or lower_percetiel or upper_percentile&quot;</span>


        <span class="k">if</span> <span class="n">orig_len</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: current request to delete all files, please select a subset of files to delete.&#39;</span><span class="p">,</span> <span class="n">orig_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">metric</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span> <span class="n">lower_threshold</span><span class="p">,</span> <span class="n">upper_threshold</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Did not find any items to delete, please check your selection&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>


        <span class="k">if</span> <span class="n">get_reformat_filename_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">filename_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">filename_col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_reformat_filename_func</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

        <span class="k">if</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span> <span class="ow">or</span> <span class="n">how</span> <span class="o">==</span> <span class="s1">&#39;move&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">inner_delete</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="n">how</span><span class="p">,</span> <span class="n">dry_run</span><span class="o">=</span><span class="n">dry_run</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">how</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;retag&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">label_col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">label_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">inner_retag</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">how</span><span class="p">,</span> <span class="n">save_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span> <span class="s2">&quot;How should be one of &#39;delete&#39;|&#39;move&#39;|&#39;retag&#39;&quot;</span>

        <span class="n">fastdup_performance_capture</span><span class="p">(</span><span class="s2">&quot;delete_or_retag_stats_outliers&quot;</span><span class="p">,</span> <span class="n">start_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">files</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">fastdup_capture_exception</span><span class="p">(</span><span class="s2">&quot;delete_or_retag_stats_outliers&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "search": "assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.6c7ad80a.min.js"></script>
      
    
  </body>
</html>